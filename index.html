<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.0">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon.ico">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon.ico">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"www.apomelo.cc","root":"/","scheme":"Pisces","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"appID":"A3LWYBODE0","apiKey":"c40595ca0a82310430032a8bc32214a2","indexName":"apomelo","hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="我有一壶酒，足以慰风尘。尽倾江海里，赠饮天下人。">
<meta property="og:type" content="website">
<meta property="og:title" content="Apomelo - 追逐">
<meta property="og:url" content="http://www.apomelo.cc/index.html">
<meta property="og:site_name" content="Apomelo - 追逐">
<meta property="og:description" content="我有一壶酒，足以慰风尘。尽倾江海里，赠饮天下人。">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="Apomelo">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://www.apomelo.cc/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'zh-CN'
  };
</script>

  <title>Apomelo - 追逐</title>
  
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-2KQDESYMZF"></script>
    <script>
      if (CONFIG.hostname === location.hostname) {
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-2KQDESYMZF');
      }
    </script>


  <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?6c01cfc90b27c8f2cf8c97e38b2f117c";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>




  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Apomelo - 追逐</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container"></div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="algolia-results">
  <div id="algolia-stats"></div>
  <div id="algolia-hits"></div>
  <div id="algolia-pagination" class="algolia-pagination"></div>
</div>

      
    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://www.apomelo.cc/posts/mysql/2019-07-21/mysql%E7%AC%94%E8%AE%B0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Apomelo">
      <meta itemprop="description" content="我有一壶酒，足以慰风尘。尽倾江海里，赠饮天下人。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Apomelo - 追逐">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/posts/mysql/2019-07-21/mysql%E7%AC%94%E8%AE%B0/" class="post-title-link" itemprop="url">MySQL笔记</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019-07-21 00:00:00" itemprop="dateCreated datePublished" datetime="2019-07-21T00:00:00+08:00">2019-07-21</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-07-01 00:00:00" itemprop="dateModified" datetime="2021-07-01T00:00:00+08:00">2021-07-01</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/mysql/" itemprop="url" rel="index"><span itemprop="name">mysql</span></a>
                </span>
            </span>

          
            <span id="/posts/mysql/2019-07-21/mysql%E7%AC%94%E8%AE%B0/" class="post-meta-item leancloud_visitors" data-flag-title="MySQL笔记" title="阅读次数">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span class="leancloud-visitors-count"></span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="事务"><a href="#事务" class="headerlink" title="事务"></a>事务</h2><h4 id="特性"><a href="#特性" class="headerlink" title="特性"></a>特性</h4><p>事务具有 ACID 特性，A: 原子性（atomicity，或称不可分割性）、C: 一致性（consistency）、I: 隔离性（isolation，又称独立性）、D: 持久性（durability）</p>
<h5 id="原子性"><a href="#原子性" class="headerlink" title="原子性"></a>原子性</h5><p>一个事务必须被视为一个不可分割的最小工作单元</p>
<h5 id="一致性"><a href="#一致性" class="headerlink" title="一致性"></a>一致性</h5><p>数据库总是从一个一致性的状态转换到另一个一致性的状态</p>
<h5 id="隔离性"><a href="#隔离性" class="headerlink" title="隔离性"></a>隔离性</h5><p>通常来说，一个事务所做的修改在最终提交之前，对其他事务是不可见的</p>
<h5 id="持久性"><a href="#持久性" class="headerlink" title="持久性"></a>持久性</h5><p>一旦事务提交，其所做的修改就会永久保存到数据库中</p>
<h4 id="数据读取问题"><a href="#数据读取问题" class="headerlink" title="数据读取问题"></a>数据读取问题</h4><h5 id="脏读"><a href="#脏读" class="headerlink" title="脏读"></a>脏读</h5><p>读取未提交数据</p>
<h5 id="不可重复读"><a href="#不可重复读" class="headerlink" title="不可重复读"></a>不可重复读</h5><p>前后多次读取，数据内容不一致</p>
<h5 id="幻读"><a href="#幻读" class="headerlink" title="幻读"></a>幻读</h5><p>前后多次读取，数据总量不一致</p>
<p>当某个事务在读取某个范围内的记录时，另外一个事务又在该范围内插入新的记录，当之前的事务再次读取该范围的记录时，会产生幻行</p>
<h5 id="不可重复读和幻读的区别"><a href="#不可重复读和幻读的区别" class="headerlink" title="不可重复读和幻读的区别"></a>不可重复读和幻读的区别</h5><ol>
<li>不可重复读是读取了其他事务更改的数据，针对update操作</li>
<li>幻读是读取了其他事务新增的数据，针对insert和delete操作</li>
</ol>
<h4 id="隔离级别"><a href="#隔离级别" class="headerlink" title="隔离级别"></a>隔离级别</h4><p>数据库事务的隔离级别有 4 种，由低到高分别为 Read uncommitted 、Read committed 、Repeatable read 、Serializable</p>
<h5 id="Read-uncommitted"><a href="#Read-uncommitted" class="headerlink" title="Read uncommitted"></a>Read uncommitted</h5><p>读未提交，顾名思义，就是一个事务可以读取另一个未提交事务的数据</p>
<p>从性能上来说，该级别不会比其他的级别好太多，但是缺乏其他级别的很多好处，所以除非真的有非常必要的理由，在实际应用中一般很少使用</p>
<h5 id="Read-committed"><a href="#Read-committed" class="headerlink" title="Read committed"></a>Read committed</h5><p>读提交，顾名思义，就是一个事务要等另一个事务提交后才能读取数据</p>
<p>大多数数据库系统的默认隔离级别都是 Read committed（但MySQL不是）</p>
<h5 id="Repeatable-read"><a href="#Repeatable-read" class="headerlink" title="Repeatable read"></a>Repeatable read</h5><p>重复读，就是在开始读取数据（事务开启）时，不再允许修改操作，保证了在同一个事务中多次读取同样记录的结果是一致的</p>
<p>Repeatable read是MySQL的默认事务隔离级别</p>
<p>InnoDB通过多版本并发控制（MVCC, Multiversion Concurrency Control）<strong>基本</strong>解决了幻读的问题，MVCC以乐观锁为理论基础，MVCC的实现没有固定的规范，每个数据库都会有不同的实现方式</p>
<h5 id="Serializable"><a href="#Serializable" class="headerlink" title="Serializable"></a>Serializable</h5><p>Serializable 是最高的事务隔离级别，在该级别下，事务串行化顺序执行，可以避免脏读、不可重复读与幻读。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://www.apomelo.cc/posts/protocol/2019-06-28/protobuf%E7%AC%94%E8%AE%B0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Apomelo">
      <meta itemprop="description" content="我有一壶酒，足以慰风尘。尽倾江海里，赠饮天下人。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Apomelo - 追逐">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/posts/protocol/2019-06-28/protobuf%E7%AC%94%E8%AE%B0/" class="post-title-link" itemprop="url">protobuf使用详解</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019-06-28 00:00:00" itemprop="dateCreated datePublished" datetime="2019-06-28T00:00:00+08:00">2019-06-28</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/protocol/" itemprop="url" rel="index"><span itemprop="name">protocol</span></a>
                </span>
            </span>

          
            <span id="/posts/protocol/2019-06-28/protobuf%E7%AC%94%E8%AE%B0/" class="post-meta-item leancloud_visitors" data-flag-title="protobuf使用详解" title="阅读次数">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span class="leancloud-visitors-count"></span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="proto"><a href="#proto" class="headerlink" title="proto"></a>proto</h2><h4 id="版本"><a href="#版本" class="headerlink" title="版本"></a>版本</h4><p>proto2</p>
<h4 id="语法"><a href="#语法" class="headerlink" title="语法"></a>语法</h4><h5 id="字段域类型（Specifying-Field-Rules）"><a href="#字段域类型（Specifying-Field-Rules）" class="headerlink" title="字段域类型（Specifying Field Rules）"></a>字段域类型（Specifying Field Rules）</h5><p>You specify that message fields are one of the following:</p>
<ol>
<li><strong>required</strong>: a well-formed message must have exactly one of this field.</li>
<li><strong>optional</strong>: a well-formed message can have zero or one of this field (but not more than one).</li>
<li><strong>repeated</strong>: this field can be repeated any number of times (including zero) in a well-formed message. The order of the repeated values will be preserved.</li>
</ol>
<p>也可以用<strong>map</strong>: map&lt;string, int32&gt; param = 1;</p>
<h5 id="字段值类型（Scalar-Value-Types）"><a href="#字段值类型（Scalar-Value-Types）" class="headerlink" title="字段值类型（Scalar Value Types）"></a>字段值类型（Scalar Value Types）</h5><table>
<thead>
<tr>
<th align="left">.proto Type</th>
<th align="left">Notes</th>
<th align="left">C++ Type</th>
<th align="left">Java Type</th>
<th align="left">Python Type<a href="#refer-anchor-2"><sup>2</sup></a></th>
<th align="left">Go Type</th>
</tr>
</thead>
<tbody><tr>
<td align="left">double</td>
<td align="left"></td>
<td align="left">double</td>
<td align="left">double</td>
<td align="left">float</td>
<td align="left">*float64</td>
</tr>
<tr>
<td align="left">float</td>
<td align="left"></td>
<td align="left">float</td>
<td align="left">float</td>
<td align="left">float</td>
<td align="left">*float32</td>
</tr>
<tr>
<td align="left">int32</td>
<td align="left">Uses variable-length encoding. Inefficient for encoding negative numbers – if your field is likely to have negative values, use sint32 instead.</td>
<td align="left">int32</td>
<td align="left">int</td>
<td align="left">int</td>
<td align="left">*int32</td>
</tr>
<tr>
<td align="left">int64</td>
<td align="left">Uses variable-length encoding. Inefficient for encoding negative numbers – if your field is likely to have negative values, use sint64 instead.</td>
<td align="left">int64</td>
<td align="left">long</td>
<td align="left">int/long<a href="#refer-anchor-3"><sup>3</sup></a></td>
<td align="left">*int64</td>
</tr>
<tr>
<td align="left">uint32</td>
<td align="left">Uses variable-length encoding.</td>
<td align="left">uint32</td>
<td align="left">int<a href="#refer-anchor-1"><sup>1</sup></a></td>
<td align="left">int/long<a href="#refer-anchor-3"><sup>3</sup></a></td>
<td align="left">*uint32</td>
</tr>
<tr>
<td align="left">uint64</td>
<td align="left">Uses variable-length encoding.</td>
<td align="left">uint64</td>
<td align="left">long<a href="#refer-anchor-1"><sup>1</sup></a></td>
<td align="left">int/long<a href="#refer-anchor-3"><sup>3</sup></a></td>
<td align="left">*uint64</td>
</tr>
<tr>
<td align="left">sint32</td>
<td align="left">Uses variable-length encoding. Signed int value. These more efficiently encode negative numbers than regular int32s.</td>
<td align="left">int32</td>
<td align="left">int</td>
<td align="left">int</td>
<td align="left">*int32</td>
</tr>
<tr>
<td align="left">sint64</td>
<td align="left">Uses variable-length encoding. Signed int value. These more efficiently encode negative numbers than regular int64s.</td>
<td align="left">int64</td>
<td align="left">long</td>
<td align="left">int/long<a href="#refer-anchor-3"><sup>3</sup></a></td>
<td align="left">*int64</td>
</tr>
<tr>
<td align="left">fixed32</td>
<td align="left">Always four bytes. More efficient than uint32 if values are often greater than 228.</td>
<td align="left">uint32</td>
<td align="left">int<a href="#refer-anchor-1"><sup>1</sup></a></td>
<td align="left">int/long<a href="#refer-anchor-3"><sup>3</sup></a></td>
<td align="left">*uint32</td>
</tr>
<tr>
<td align="left">fixed64</td>
<td align="left">Always eight bytes. More efficient than uint64 if values are often greater than 256.</td>
<td align="left">uint64</td>
<td align="left">long<a href="#refer-anchor-1"><sup>1</sup></a></td>
<td align="left">int/long<a href="#refer-anchor-3"><sup>3</sup></a></td>
<td align="left">*uint64</td>
</tr>
<tr>
<td align="left">sfixed32</td>
<td align="left">Always four bytes.</td>
<td align="left">int32</td>
<td align="left">int</td>
<td align="left">int</td>
<td align="left">*int32</td>
</tr>
<tr>
<td align="left">sfixed64</td>
<td align="left">Always eight bytes.</td>
<td align="left">int64</td>
<td align="left">long</td>
<td align="left">int/long<a href="#refer-anchor-3"><sup>3</sup></a></td>
<td align="left">*int64</td>
</tr>
<tr>
<td align="left">bool</td>
<td align="left">bool</td>
<td align="left">boolean</td>
<td align="left">bool</td>
<td align="left">*bool</td>
<td align="left"></td>
</tr>
<tr>
<td align="left">string</td>
<td align="left">A string must always contain UTF-8 encoded or 7-bit ASCII text.</td>
<td align="left">string</td>
<td align="left">String</td>
<td align="left">unicode (Python 2) or str (Python 3)</td>
<td align="left">*string</td>
</tr>
<tr>
<td align="left">bytes</td>
<td align="left">May contain any arbitrary sequence of bytes.</td>
<td align="left">string</td>
<td align="left">ByteString</td>
<td align="left">bytes</td>
<td align="left">[]byte</td>
</tr>
</tbody></table>
<p>You can find out more about how these types are encoded when you serialize your message in Protocol Buffer Encoding.</p>
<ul>
<li><div id="refer-anchor-1"> [1] In Java, unsigned 32-bit and 64-bit integers are represented using their signed counterparts, with the top bit simply being stored in the sign bit.</div></li>
<li><div id="refer-anchor-2">[2] In all cases, setting values to a field will perform type checking to make sure it is valid.</div></li>
<li><div id="refer-anchor-3">[3] 64-bit or unsigned 32-bit integers are always represented as long when decoded, but can be an int if an int is given when setting the field. In all cases, the value must fit in the type represented when set. See [2].</div></li>
</ul>
<h4 id="消息体"><a href="#消息体" class="headerlink" title="消息体"></a>消息体</h4><p><strong>示例</strong></p>
<figure class="highlight protobuf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">message</span> <span class="title">SearchRequest</span> </span>&#123;</span><br><span class="line">    <span class="keyword">required</span> <span class="built_in">string</span> query = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">optional</span> <span class="built_in">int32</span> pageNumber = <span class="number">2</span>;</span><br><span class="line">    <span class="keyword">optional</span> <span class="built_in">int32</span> resultPerPage = <span class="number">3</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">enum</span> <span class="title">Corpus</span> </span>&#123;</span><br><span class="line">    UNIVERSAL = <span class="number">0</span>;</span><br><span class="line">    WEB = <span class="number">1</span>;</span><br><span class="line">    IMAGES = <span class="number">2</span>;</span><br><span class="line">    LOCAL = <span class="number">3</span>;</span><br><span class="line">    NEWS = <span class="number">4</span>;</span><br><span class="line">    PRODUCTS = <span class="number">5</span>;</span><br><span class="line">    VIDEO = <span class="number">6</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>enum可以定义在message中, 也可以定义在外面。</p>
<p>proto文件批量编译</p>
<figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> <span class="variable">%%i</span> <span class="keyword">in</span> (*.proto) <span class="keyword">do</span> (</span><br><span class="line">    .\protoc.exe --java_out=.\java\ <span class="variable">%%i</span></span><br><span class="line">)</span><br><span class="line"><span class="built_in">pause</span></span><br></pre></td></tr></table></figure>

<p><strong>注意事项</strong></p>
<ol>
<li>syntax = “proto2”表示用的是proto2, 不声明默认proto3<br> 原因: 某些语言不支持proto3，如：lua</li>
<li>package表示在的包目录</li>
<li>option java_outer_classname表示生成的java文件名</li>
<li>message中引用自定义的message类型, 被引用的message需要放在上方<br> 原因: 某些语言是顺序读取, 不支持乱序读取，如：lua</li>
</ol>
<!-- #### 程序中请求定义

**示例**
<figure class="highlight protobuf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">syntax = <span class="string">&quot;proto2&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">package</span> com.apomelo.test.protobuf;</span><br><span class="line"><span class="keyword">option</span> java_outer_classname = <span class="string">&quot;TestMessage&quot;</span>;</span><br><span class="line"><span class="comment">//range: 101---199</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">message</span> <span class="title">TestReq</span> </span>&#123;</span><br><span class="line">    <span class="keyword">required</span> <span class="built_in">int32</span> query = <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">message</span> <span class="title">TestResp</span> </span>&#123;</span><br><span class="line">    <span class="keyword">required</span> <span class="built_in">int32</span> query = <span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>注意事项</strong></p>
<ol>
<li>//range: 101—199 这个必须有, 格式也要一样, 数值可以更改, 如: //range: 201—299<br> 原因: proto生成工具需要用到</li>
<li>请求必须以Req结尾, 响应必须以Resp结尾<br> 原因: 这样定义之后可以直接用工具生成相应的请求处理器</li>
</ol>
<h2 id="工具使用"><a href="#工具使用" class="headerlink" title="工具使用"></a>工具使用</h2><h4 id="proto编译工具"><a href="#proto编译工具" class="headerlink" title="proto编译工具"></a>proto编译工具</h4><ol>
<li>根据请求生成请求类型<br> 工具: src/main/resources/bin/build/proto_handler_generate.py<br> 命令: python proto_handler_generate.py<br> 可选参数: proto_path（proto文件所在目录）, build_path（生成的Java请求处理器所在的目录）, rebuild（是否重新构建所有的请求, 默认false）</li>
<li>编译proto<br> 工具: src/main/resources/proto/build.bat<br> 命令: 直接运行（根据需求自己修改生成的目录）</li>
<li>复制proto文件并提交到项目的proto文件夹中<br> 工具: src/main/resources/proto/copy.bat<br> 命令: 直接运行（根据需求自己修改复制的目录） –&gt;</li>
</ol>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://www.apomelo.cc/posts/tool/2019-06-05/jenkins%E7%AC%94%E8%AE%B0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Apomelo">
      <meta itemprop="description" content="我有一壶酒，足以慰风尘。尽倾江海里，赠饮天下人。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Apomelo - 追逐">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/posts/tool/2019-06-05/jenkins%E7%AC%94%E8%AE%B0/" class="post-title-link" itemprop="url">jenkins部署及使用</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019-06-05 00:00:00" itemprop="dateCreated datePublished" datetime="2019-06-05T00:00:00+08:00">2019-06-05</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/tool/" itemprop="url" rel="index"><span itemprop="name">tool</span></a>
                </span>
            </span>

          
            <span id="/posts/tool/2019-06-05/jenkins%E7%AC%94%E8%AE%B0/" class="post-meta-item leancloud_visitors" data-flag-title="jenkins部署及使用" title="阅读次数">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span class="leancloud-visitors-count"></span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="jdk版本"><a href="#jdk版本" class="headerlink" title="jdk版本"></a>jdk版本</h2><h4 id="版本"><a href="#版本" class="headerlink" title="版本"></a>版本</h4><p>V1.8</p>
<p>也可用新版本</p>
<p><a target="_blank" rel="noopener" href="https://www.oracle.com/java/technologies/javase-downloads.html">Java jdk 下载地址</a></p>
<h2 id="jenkins"><a href="#jenkins" class="headerlink" title="jenkins"></a>jenkins</h2><h4 id="安装环境"><a href="#安装环境" class="headerlink" title="安装环境"></a>安装环境</h4><p>Ubuntu 18.04.2 LTS</p>
<h4 id="安装方式"><a href="#安装方式" class="headerlink" title="安装方式"></a>安装方式</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">wget -q -O - https://pkg.jenkins.io/debian/jenkins.io.key | sudo apt-key add -</span><br><span class="line">sudo sh -c <span class="string">&#x27;echo deb http://pkg.jenkins.io/debian-stable binary/ &gt; /etc/apt/sources.list.d/jenkins.list&#x27;</span></span><br><span class="line">sudo apt-get update</span><br><span class="line">sudo apt-get install jenkins</span><br></pre></td></tr></table></figure>

<p>更改<code>/etc/init.d/jenkins</code>中配置: </p>
<ol>
<li>$HTTP_PORT后面端口为想要的端口, 如: 8800</li>
<li>PATH中加上本机java所在目录, 如: /usr/local/java/jdk1.8.0_212/bin</li>
</ol>
<p>更改<code>/etc/default/jenkins</code>中设置: </p>
<ol>
<li>JAVA_ARGS=”-Djava.awt.headless=true -Xmx512m”, 作用是限制jenkins内存, 只是本机构建, 512m就够用了</li>
<li>HTTP_PORT=8800 修改http端口</li>
</ol>
<p>其他默认即可</p>
<p>首次启动选择默认jenkins插件即可, 其他跟着一步一步操作即可</p>
<p>用到maven或者其他构建工具，需要在<em>全局工具配置</em>中进行配置</p>
<h4 id="构建项目"><a href="#构建项目" class="headerlink" title="构建项目"></a>构建项目</h4><p>一般来说选择<em>构建一个自由风格的软件项目</em>这一条就好，其他后需要的请在官网查看</p>
<ol>
<li>General, 根据需要选择构建信息，如果选择参数化构建过程，参数的名称在下面能够用到</li>
<li>源码管理，根据需要选择对应的代码管理，git或者svn</li>
<li>构建触发器，自行选择</li>
<li>构建环境，一般情况用不到，可以根据项目需求选用</li>
<li>构建，可以进行maven构建、shell执行等等</li>
</ol>
<p><strong>注意事项</strong></p>
<ol>
<li>部署应用之后如果应用刚起来就被jenkins杀掉，则需要在启动前加 <code>BUILD_ID=project</code> 这一行, project替换为自己的项目名<br> 如：构建好java应用，然后在<em>构建</em>那一栏增加执行shell，把构建好的Java应用部署到指定目录，然后用命令启动该程序，在启动该程序前需要加入该语句<br>代码示例：<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">&quot;pwd: &quot;</span>`<span class="built_in">pwd</span>`</span><br><span class="line"><span class="built_in">cd</span> ./target</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;pwd: &quot;</span>`<span class="built_in">pwd</span>`</span><br><span class="line">tar -xzvf project-deploy.tar.gz</span><br><span class="line"></span><br><span class="line">BUILD_ID=project</span><br><span class="line">bash ./project/bin/deploy.sh <span class="variable">$&#123;deploy_path&#125;</span> <span class="variable">$&#123;run_mode&#125;</span></span><br></pre></td></tr></table></figure>
上面的<code>deploy.sh</code>脚本自己根据需要自行编写，<em>deploy_path</em>和<em>run_mode</em>是<em>General</em>步骤中的参数名称</li>
</ol>
<p>除了BUILD_ID还有其他的可用的环境变量，<em>构建</em>步骤中的<em>执行shell</em>下面可以查看比较全的变量，也可以在官网看可以使用的<a target="_blank" rel="noopener" href="https://www.jenkins.io/zh/doc/book/pipeline/jenkinsfile/#%E4%BD%BF%E7%94%A8%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F">环境变量</a></p>
<p><a target="_blank" rel="noopener" href="https://jenkins.io/zh/doc/book/installing/">官方参考文档</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://www.apomelo.cc/posts/architecture/2019-04-26/rest%E8%BD%AF%E4%BB%B6%E6%9E%B6%E6%9E%84/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Apomelo">
      <meta itemprop="description" content="我有一壶酒，足以慰风尘。尽倾江海里，赠饮天下人。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Apomelo - 追逐">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/posts/architecture/2019-04-26/rest%E8%BD%AF%E4%BB%B6%E6%9E%B6%E6%9E%84/" class="post-title-link" itemprop="url">REST软件架构</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019-04-26 00:00:00" itemprop="dateCreated datePublished" datetime="2019-04-26T00:00:00+08:00">2019-04-26</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2019-04-30 00:00:00" itemprop="dateModified" datetime="2019-04-30T00:00:00+08:00">2019-04-30</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/architecture/" itemprop="url" rel="index"><span itemprop="name">architecture</span></a>
                </span>
            </span>

          
            <span id="/posts/architecture/2019-04-26/rest%E8%BD%AF%E4%BB%B6%E6%9E%B6%E6%9E%84/" class="post-meta-item leancloud_visitors" data-flag-title="REST软件架构" title="阅读次数">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span class="leancloud-visitors-count"></span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h4 id="Web技术发展"><a href="#Web技术发展" class="headerlink" title="Web技术发展"></a>Web技术发展</h4><p>World Wide Web（万维网），简称Web，是一种基于超文本和HTTP的、全球性的、动态交互的、跨平台的分布式图形信息系统。</p>
<h5 id="web形式发展"><a href="#web形式发展" class="headerlink" title="web形式发展"></a>web形式发展</h5><p>先后经历了web 1.0 —&gt; web 2.0 —&gt; web 3.0</p>
<p><strong>web 1.0</strong><br>开始于1994年，主要是静态的HTML页面发布信息，其特点是：信息杂乱无序，只满足了人们对信息的搜索、传递需求。</p>
<p><strong>web 2.0</strong><br>开始于2004年，在web 2.0中，软件被当成一种服务，Internet从一系列网站演化成一个成熟的为最终用户提供网络应用的服务平台，强调用户的参与、在线的网络协作、数据储存的网络化、社会关系网络、RSS应用以及文件的共享等成为了web 2.0发展的主要支撑和表现。web 2.0模式大大激发了创造和创新的积极性，使Internet重新变得生机勃勃。web 2.0的典型应用包括Blog、Wiki、RSS、Tag、SNS、P2P、IM等。其特点是：更加注重交互性；核心是指导思想；与1.0没有绝对的界限。</p>
<p><strong>web 3.0</strong><br>正在步入3.0，其特点是：智能化及个性化搜索引擎；数据的自由整合与有效聚合；适合多种终端平台，实现信息服务的普适性。</p>
<h6 id="web开发技术几个阶段"><a href="#web开发技术几个阶段" class="headerlink" title="web开发技术几个阶段"></a>web开发技术几个阶段</h6><ol>
<li><p>静态内容阶段<br>这个阶段web服务器作为共享文件服务器，存的大多是静态的HTML文档。</p>
</li>
<li><p>CGI程序阶段<br>这个阶段web服务器增加了一些编程API，通过API可以向客户端提供一些动态变化的内容。通信使用CGI（Common Gateway Interface）协议。</p>
</li>
<li><p>脚本语言阶段<br>这个阶段服务端出现ASP、PHP、JSP等，浏览器端出现Java Applet、Js等，提供了更加丰富的内容。</p>
</li>
<li><p>瘦客户端应用阶段<br>这个阶段出现了MVC模式，服务器端生成全部的动态内容。</p>
</li>
<li><p>RIA应用阶段<br>这个阶段出现了大量的RIA（Rich Internet Applications）技术，极大的完善了Web的用户体验，比如Ajax。</p>
</li>
<li><p>移动Web应用阶段<br>这个阶段出现了大量面向移动设备的Web应用技术，除了IOS、Android等操作系统平台原声的开发技术外，基于H5的开发技术越来越流行。</p>
</li>
</ol>
<h5 id="web技术结构基石"><a href="#web技术结构基石" class="headerlink" title="web技术结构基石"></a>web技术结构基石</h5><ol>
<li><p>URI</p>
</li>
<li><p>HTTP</p>
</li>
<li><p>HTML</p>
</li>
<li><p>MIME</p>
</li>
</ol>
<h4 id="REST介绍"><a href="#REST介绍" class="headerlink" title="REST介绍"></a>REST介绍</h4><p>REST（Representational State Transfer, 表现层状态转换）软件架构是由Roy Thomas Fielding博士在2000年首次提出的。他为我们描绘了开发基于互联网的网络软件的蓝图。REST软件架构是一个抽象的概念，是一种为了实现这一互联网的超媒体分布式系统的行动指南。</p>
<p>REST是目前世界上最成功的分布式应用架构风格（Web），<br>REST是所有Web应用都应该遵守的架构指导原则，违反了REST<br>的指导原则，网站应用功能仍能实现，但会付出很多代价，特别是<br>大流量的网站。</p>
<p>在不同阶段，REST给我们不同的印象：</p>
<ul>
<li>没接触REST时，会认为REST是一个技术</li>
<li>没有深入理解REST，日常使用仅限于修改REST风格的URI、增加PUT、DELETE操作等，会认为REST是一种具体的规范</li>
<li>深入理解之后，会发现REST是一种内含丰富的架构风格</li>
</ul>
<h4 id="REST的五个关键词"><a href="#REST的五个关键词" class="headerlink" title="REST的五个关键词"></a>REST的五个关键词</h4><h5 id="1-资源（Resource）"><a href="#1-资源（Resource）" class="headerlink" title="1. 资源（Resource）"></a>1. 资源（Resource）</h5><p>资源是一种看待服务器的方式，服务器就是由很多离散的资源组成。资源是以名词为核心来组织的，首先关注的应该是名词。一个资源由一个或多个URI来标识，URI也即是资源的名称，客户端对某个资源感兴趣即通过URI来交互。</p>
<h5 id="2-资源的表述（Representation）"><a href="#2-资源的表述（Representation）" class="headerlink" title="2. 资源的表述（Representation）"></a>2. 资源的表述（Representation）</h5><p>资源表述是指某一个资源某个时刻的状态描述，用于在客户端和服务端转移。例如：HTML/XML/JSON/图片/音频都是资源表述的格式。在通常的REST开发下，一般使用JSON作为HTTP请求响应的资源表述。</p>
<h5 id="3-状态转移（State-Transfer）"><a href="#3-状态转移（State-Transfer）" class="headerlink" title="3. 状态转移（State Transfer）"></a>3. 状态转移（State Transfer）</h5><p>状态转移是指通过转移和操作资源的表述，来实现操作资源的目的。在REST开发下，通常使用HTTP的GET/POST/PUT/DELETE方法操作。</p>
<h5 id="4-统一接口（Uniform-Interface）"><a href="#4-统一接口（Uniform-Interface）" class="headerlink" title="4. 统一接口（Uniform Interface）"></a>4. 统一接口（Uniform Interface）</h5><p><span id="统一接口"></span>REST要求必须使用统一的接口来对资源进行操作。</p>
<p>REST要求对资源执行的操作，操作语义必须在HTPP消息体之前的部分完全表达，不能将操作语义封装到消息体内部。这样做为了提高交互可见性，便于通信的中间件实现缓存和安全审核。</p>
<p>REST是不依赖于任何协议的，但目前几乎所有的REST都是基于HTTP协议的。接口应该使用标准的HTTP方法如GET，PUT和POST，并遵循这些方法的语义。</p>
<p>非REST的接口，1000个人能写出1000个接口，例如对机器人的操作：<br>（1）/api/findRobots<br>（2）/api/robots/select<br>REST API：<br>&emsp;GET    /rest/robots/{id} 查询一个机器人<br>&emsp;POST   /rest/robots      新建一个机器人<br>&emsp;PUT    /rest/robots/{id} 更新一个机器人<br>&emsp;DELETE /rest/robots/{id} 删除一个机器人</p>
<p><strong>统一接口主要包括：</strong><br>（1）7个HTTP方法：GET/POST/PUT/DELETE/PATCH/HEAD/OPTIONS<br>（2）HTTP头信息（可自定义）<br>（3）HTTP响应状态代码（可自定义）<br>（4）一套标准的内容协商机制<br>（5）一套标准的缓存机制<br>（6）一套标准的客户端身份认证机制</p>
<p><strong>HTTP方法幂等性</strong><br>幂等是指一次或多次请求一个资源的时候，应该具有相同的副作用。<br><strong>HTTP方法安全性</strong><br>安全是指对原有资源没有任何影响，安全性不代表请求一定不产生副作用。比如GET请求增加计数器，这种产生的副作用是服务端自作主张，服务端在设计的时候应该不让副作用太大，客户端可以这些请求不会产生副作用。</p>
<p>GET: 安全且幂等，用来获取资源表示<br>POST: 不安全且不幂等，用来创建资源或用于部分更新资源<br>PUT: 不安全且幂等，用替换的方式更新资源<br>DELETE: 不安全且幂等，用于删除一个资源</p>
<p>PUT和POST的区别：<br>PUT和POST最大的区别是PUT是幂等的，此外PUT需要完成的URI。<br>PUT    /rest/robots/        是不会成功的，URI不能定位到具体的资源<br>PUT    /rest/robots/{1234}  是会成功的，如果存在，则更新这个robots</p>
<h5 id="5-超文本驱动（Hypertext-Driven）"><a href="#5-超文本驱动（Hypertext-Driven）" class="headerlink" title="5. 超文本驱动（Hypertext Driven）"></a>5. 超文本驱动（Hypertext Driven）</h5><p>2008.10.28Fielding博士针对REST的滥用，发表了《REST API 必须是超文本驱动的》。他指出除非应用状态引擎是超文本驱动的，否则它就不是RESTFUL。</p>
<p>超文本驱动是客户端不再需要将某些接口的 URI 硬编码在代码中，唯一需要存储的只是 API 的 HOST 地址，能够非常有效的降低客户端与服务端之间的耦合，服务端对 URI 的任何改动都不会影响到客户端的稳定。</p>
<h4 id="REST架构约束"><a href="#REST架构约束" class="headerlink" title="REST架构约束"></a>REST架构约束</h4><h5 id="1-客户-服务器（Client-Server）"><a href="#1-客户-服务器（Client-Server）" class="headerlink" title="1. 客户-服务器（Client-Server）"></a>1. 客户-服务器（Client-Server）</h5><p>这个约束是基于客户端-服务器架构背后的原则—–关注点分离。通过分离用户界面和数据存储这两个关注点，提高了用户界面跨平台的可能性，通过简化服务器组件提高了其伸缩性。</p>
<h5 id="2-无状态（Stateless）"><a href="#2-无状态（Stateless）" class="headerlink" title="2. 无状态（Stateless）"></a>2. 无状态（Stateless）</h5><p>服务器不保存除单次请求外的通信状态，REST要求状态要么被放入资源状态中，要么保存在客户端，从客户端发出的每个请求都包含了服务端所必须的信息。</p>
<p>无状态约束使服务器的变化对客户端不可见，因而在连续的请求中，客户端并不依赖于同一台服务器，一台服务器坏掉了，客户端感知不到。</p>
<h5 id="3-可缓存（Cachable）"><a href="#3-可缓存（Cachable）" class="headerlink" title="3. 可缓存（Cachable）"></a>3. 可缓存（Cachable）</h5><p>互联网中的客户端和中间层服务器可以缓存响应。</p>
<p>因此响应必须直接或间接定义自身是否可被缓存，以免客户端使用过期的响应数据来发送其它请求。</p>
<p>良好的缓存策略可以有效减少客户端-服务器之间的交互，从而进一步提高系统的可伸缩性和性能。</p>
<h5 id="4-分层系统-（Layered-system）"><a href="#4-分层系统-（Layered-system）" class="headerlink" title="4. 分层系统 （Layered system）"></a>4. 分层系统 （Layered system）</h5><p>通过限制组件的行为（即，每个组件只能“看到”与其交互的紧邻层），将架构分解为若干等级的层。</p>
<p>客户端通常无法判断它是否是直接连接到后端服务器，还是中间服务器。</p>
<p>中间服务器可通过启用负载平衡，并通过提供共享高速缓存来提高系统的可扩展性。</p>
<p>当然也可以强制执行安全政策。</p>
<h5 id="5-统一接口-（Unitform-interface）"><a href="#5-统一接口-（Unitform-interface）" class="headerlink" title="5. 统一接口 （Unitform interface）"></a>5. 统一接口 （Unitform interface）</h5><p><a href="#%E7%BB%9F%E4%B8%80%E6%8E%A5%E5%8F%A3">如上</a><br>(1) 资源标志的唯一性<br>(2) 资源的自描述性<br>(3) 超媒体驱动型<br>(4) 消息的自描述性</p>
<h5 id="6-按需代码（可选）"><a href="#6-按需代码（可选）" class="headerlink" title="6. 按需代码（可选）"></a>6. 按需代码（可选）</h5><p>支持通过下载并执行一些代码（例如Java Applet、Flash或JavaScript），对客户端的功能进行扩展。</p>
<h4 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h4><ol>
<li><a target="_blank" rel="noopener" href="https://baike.baidu.com/item/Web/150564">https://baike.baidu.com/item/Web/150564</a></li>
<li><a target="_blank" rel="noopener" href="https://baike.baidu.com/item/REST%E8%BD%AF%E4%BB%B6%E6%9E%B6%E6%9E%84/2018579?fr=aladdin">https://baike.baidu.com/item/REST%E8%BD%AF%E4%BB%B6%E6%9E%B6%E6%9E%84/2018579?fr=aladdin</a></li>
<li><a target="_blank" rel="noopener" href="https://www.ics.uci.edu/~fielding/pubs/dissertation/top.htm">Roy Thomas Fielding博士论文地址</a></li>
</ol>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://www.apomelo.cc/posts/other/2019-04-29/%E6%9D%82%E4%B8%83%E6%9D%82%E5%85%AB%E7%AC%94%E8%AE%B0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Apomelo">
      <meta itemprop="description" content="我有一壶酒，足以慰风尘。尽倾江海里，赠饮天下人。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Apomelo - 追逐">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/posts/other/2019-04-29/%E6%9D%82%E4%B8%83%E6%9D%82%E5%85%AB%E7%AC%94%E8%AE%B0/" class="post-title-link" itemprop="url">杂七杂八笔记</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019-04-29 00:00:00" itemprop="dateCreated datePublished" datetime="2019-04-29T00:00:00+08:00">2019-04-29</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/other/" itemprop="url" rel="index"><span itemprop="name">other</span></a>
                </span>
            </span>

          
            <span id="/posts/other/2019-04-29/%E6%9D%82%E4%B8%83%E6%9D%82%E5%85%AB%E7%AC%94%E8%AE%B0/" class="post-meta-item leancloud_visitors" data-flag-title="杂七杂八笔记" title="阅读次数">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span class="leancloud-visitors-count"></span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h3 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h3><p>平日积累的一些小笔记，因比较杂且短，先放到本文中。</p>
<h3 id="正则"><a href="#正则" class="headerlink" title="正则"></a>正则</h3><p>$0——$9</p>
<p>$0代表完整的模式匹配文本（想index.css的话它全部都变成的斜体）,$1代表第一个x小括号的字串</p>
<p>比如 /gai([\w]+?)over([\d]+)/ 匹配 gainover123 $1= 括号里的 n $2= 第2个括号里的 123</p>
<h3 id="jdb命令"><a href="#jdb命令" class="headerlink" title="jdb命令"></a>jdb命令</h3><p>jdb -connect sun.jvm.hotspot.jdi.SAPIDAttachingConnector:pid=<br>jdb -attach 127.0.0.1:<br>stop in org.zoolu.iax.protocol.peer.Peer.handleRecvFrame(byte[])<br>clear org.zoolu.iax.protocol.peer.Peer.handleRecvFrame(byte[])</p>
<h3 id="Component和Repository注入两次解决方案"><a href="#Component和Repository注入两次解决方案" class="headerlink" title="Component和Repository注入两次解决方案"></a>Component和Repository注入两次解决方案</h3><p>因为一些需要，所以需要加个定时器，并且在InitializingBean中的afterPropertiesSet中启动。完成后，加了一些log，看一下是否成功。</p>
<p>最初的时候是在加了@Repository注解的类里面实现的，当时日志就重复打印了一次，一共打印了两次，但是当时在调试主要功能，也没太注意。后来，为了Dao类的纯粹性，就把定时器移到了加了@Service的类里面。这时候，日志打印次数正常。</p>
<p>后来，功能调试OK后，觉得放在Service中也不太合适，就新建了一个类，把定时器移到了Component中，然后运行，如果无误，就准备提交代码了。这时候，日志又重新打印了两次。</p>
<p>然后首先想到的是去网上搜索，搜到的都是 加上@Scope(“singleton”)改为单例、把类上的@Component改为只加载一次的注解等等。</p>
<p>后来，我就用debug模式，自己去跟踪，后来发现，我的代码中@Component和@Repository被加载了两次，@Controller和@Service被加载了一次。试了很多种方案，都没有用，想加个全局变量类控制一下定时任务，但是第二次注入相当于是重新注入，所以也没有用。后来发现是配置中自动扫描注解的配置有交集。</p>
<p>在很多配置中一般都会把Spring-common.xml和Spring-MVC.xml进行分开配置，这种配置就行各施其职一样，显得特别清晰。</p>
<p>在Spring-MVC.xml中只对@Controller进行扫描就可，作为一个控制器，其他的事情不做。</p>
<p>在Spring-common.xml中只对一些事务逻辑的注解扫描。</p>
<p>现在给定一个项目包的机构:<br>com.fq.controlller<br>com.fq.service</p>
<p>正确的是：</p>
<!-- 扫描@Controller注解 -->
<p>&lt;context:component-scan base-package=”com.fq.controller”&gt;<br>    &lt;context:include-filter type=”annotation” expression=”org.springframework.stereotype.Controller” /&gt;<br></context:component-scan></p>
<p>我的配置里面Spring-MVC.xml并没有具体到controller，而是com.fq.*</p>
<p>所以我在Spring-MVC.xml中加入了exclude-filter</p>
<!-- 扫描@Controller注解 -->
<p>&lt;context:component-scan base-package=”com.fq.controller”&gt;<br>    &lt;context:include-filter type=”annotation” expression=”org.springframework.stereotype.Controller” /&gt;<br>    &lt;context:exclude-filter type=”annotation” expression=”org.springframework.stereotype.Service” /&gt;<br>    &lt;context:exclude-filter type=”annotation” expression=”org.springframework.stereotype.Repository” /&gt;<br>    &lt;context:exclude-filter type=”annotation” expression=”org.springframework.stereotype.Component” /&gt;<br></context:component-scan></p>
<p>这样，确实是加载了一次，但是访问不了Controller。经过排查，发现Controlle并没有被加载，经过测试，发现是<br>&lt;context:exclude-filter type=”annotation” expression=”org.springframework.stereotype.Component” /&gt;<br>这条语句导致的。</p>
<p>我把改为具体到Controller包，把那些exclude-filter都去掉之后，所有都正常了，但是还是对这个原因有些疑惑，然后我就看了一下include-filter和exclude-filter的区别。比较好的是下面这个文章，虽然短，但是描述的很清晰。</p>
<p>include-filter和exclude-filter的区别 <a target="_blank" rel="noopener" href="https://www.cnblogs.com/hanguocai/p/7783078.html">https://www.cnblogs.com/hanguocai/p/7783078.html</a></p>
<p>需要把<a href="context:component-scan">context:component-scan</a>的use-default-filters属性设置为false，默认为true，同时需要把那些exclude-filter去掉</p>
<h3 id="线程池"><a href="#线程池" class="headerlink" title="线程池"></a>线程池</h3><p>ThreadPoolExecutor(int corePoolSize, int maximumPoolSize, long keepAliveTime, TimeUnit unit, BlockingQueue<Runnable> workQueue)</p>
<p>workQueue 还可能是 SynchronousQueue 队列</p>
<p>当 workQueue 是 LinkedBlockingDeque<Runnable> 时，当需要执行的线程数大于 corePoolSize，则忽略 maximumPoolSize 和 keepAliveTime，在线程池里线程数达到 corePoolSize 后把之后的任务放到队列里，在队列满的时候才创建线程直到线程数达到 maximumPoolSize ，继续有任务时，抛出异常。</p>
<p>当 workQueue 是 SynchronousQueue 时，当需要执行的线程数大于 corePoolSize，在线程池里的线程数达到 corePoolSize 后，继续创建线程执行任务；当线程池里的线程数达到 maximumPoolSize 后，则继续处理之前的任务，其他任务不再处理，且抛出异常。</p>
<h3 id="yaml配置"><a href="#yaml配置" class="headerlink" title="yaml配置"></a>yaml配置</h3><p>Yaml文件被解析为Map形式</p>
<p>“:”前是key，后是value</p>
<p>每一行之前加”- “表示是数组或List</p>
<p>字符串用双引号括起来，不会对里面的内容进行转意；<br>用单引号括起来，会对里面的内容进行转意，特殊字符最终只是一个普通的字符串数据，该是什么还是什么</p>
<h3 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h3><ol>
<li>暂无</li>
</ol>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://www.apomelo.cc/posts/java/2019-04-19/%E5%9F%BA%E7%A1%80%E7%AE%97%E6%B3%95%E4%B8%93%E9%A2%98/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Apomelo">
      <meta itemprop="description" content="我有一壶酒，足以慰风尘。尽倾江海里，赠饮天下人。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Apomelo - 追逐">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/posts/java/2019-04-19/%E5%9F%BA%E7%A1%80%E7%AE%97%E6%B3%95%E4%B8%93%E9%A2%98/" class="post-title-link" itemprop="url">基础算法专题</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019-04-19 00:00:00" itemprop="dateCreated datePublished" datetime="2019-04-19T00:00:00+08:00">2019-04-19</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2019-04-23 00:00:00" itemprop="dateModified" datetime="2019-04-23T00:00:00+08:00">2019-04-23</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/java/" itemprop="url" rel="index"><span itemprop="name">java</span></a>
                </span>
            </span>

          
            <span id="/posts/java/2019-04-19/%E5%9F%BA%E7%A1%80%E7%AE%97%E6%B3%95%E4%B8%93%E9%A2%98/" class="post-meta-item leancloud_visitors" data-flag-title="基础算法专题" title="阅读次数">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span class="leancloud-visitors-count"></span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h4 id="正文"><a href="#正文" class="headerlink" title="正文"></a>正文</h4><p>最近发现自己基础算法方面还有些欠缺。虽然之前也看过数据结构、算法导论、计算机网络等等一些基础书籍，也都理解基础算法和数据结构，但因为没有每道都手写过，所以当真正去实现时还需要去查阅参考资料。由此，下定决心弥补这些不足。基础算法在工作中对业务理解、代码编写并没有非常显著的提升，但是个人觉得这些影响是潜在的，它会潜在的影响你的思考和解决方案。总之，基础夯实终归是没错的。</p>
<p>目前较为推荐的有牛客的剑指offer、LeetCode的Top 100 Liked Questions。个人更推荐LeetCode，但是牛客有手机App，如果想在上下班路上刷一刷，可以选择牛客。我也是因此选择先刷牛客，下面是相关的题目和个人通过编译的答案，不定期更新，如答案中有错误之处烦请指出。</p>
<h4 id="牛客"><a href="#牛客" class="headerlink" title="牛客"></a>牛客</h4><h5 id="1"><a href="#1" class="headerlink" title="1"></a>1</h5><p>时间限制：1秒 空间限制：32768K<br>本题知识点： 查找<br>题目描述<br>在一个二维数组中（每个一维数组的长度相同），每一行都按照从左到右递增的顺序排序，每一列都按照从上到下递增的顺序排序。请完成一个函数，输入这样的一个二维数组和一个整数，判断数组中是否含有该整数。</p>
<p>答案：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">Find</span><span class="params">(<span class="keyword">int</span> target, <span class="keyword">int</span> [][] array)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> rows = array.length;</span><br><span class="line">        <span class="keyword">int</span> cols = array[<span class="number">0</span>].length;</span><br><span class="line">        <span class="keyword">int</span> row = rows - <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">int</span> col = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span>(row &gt;= <span class="number">0</span> &amp;&amp; col &lt; cols) &#123;</span><br><span class="line">            <span class="keyword">if</span> (array[row][col] &gt; target) &#123;</span><br><span class="line">                row --;</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (array[row][col] &lt; target) &#123;</span><br><span class="line">                col ++;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="2"><a href="#2" class="headerlink" title="2"></a>2</h5><p>时间限制：1秒 空间限制：32768K<br>本题知识点： 字符串<br>题目描述<br>请实现一个函数，将一个字符串中的每个空格替换成“%20”。例如，当字符串为We Are Happy.则经过替换之后的字符串为We%20Are%20Happy。</p>
<p>答案：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 直接用replaceAll函数即可</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">replaceSpace</span><span class="params">(StringBuffer str)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> str.toString().replaceAll(<span class="string">&quot; &quot;</span>, <span class="string">&quot;%20&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="3"><a href="#3" class="headerlink" title="3"></a>3</h5><p>时间限制：1秒 空间限制：32768K<br>本题知识点： 链表<br>题目描述<br>输入一个链表，按链表值从尾到头的顺序返回一个ArrayList。</p>
<p>答案：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">*    public class ListNode &#123;</span></span><br><span class="line"><span class="comment">*        int val;</span></span><br><span class="line"><span class="comment">*        ListNode next = null;</span></span><br><span class="line"><span class="comment">*</span></span><br><span class="line"><span class="comment">*        ListNode(int val) &#123;</span></span><br><span class="line"><span class="comment">*            this.val = val;</span></span><br><span class="line"><span class="comment">*        &#125;</span></span><br><span class="line"><span class="comment">*    &#125;</span></span><br><span class="line"><span class="comment">*</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 解法1：</span></span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.Stack;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> ArrayList&lt;Integer&gt; <span class="title">printListFromTailToHead</span><span class="params">(ListNode listNode)</span> </span>&#123;</span><br><span class="line">        ArrayList&lt;Integer&gt; result = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">        <span class="keyword">if</span> (listNode == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> result;</span><br><span class="line">        &#125;</span><br><span class="line">        Stack&lt;ListNode&gt; stack = <span class="keyword">new</span> Stack();</span><br><span class="line">        <span class="keyword">while</span> (listNode != <span class="keyword">null</span>) &#123;</span><br><span class="line">            stack.push(listNode);</span><br><span class="line">            listNode = listNode.next;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">while</span> (!stack.empty()) &#123;</span><br><span class="line">            result.add(stack.pop().val);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 解法2：把1中的Stack换成LinkedList；</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 解法3：</span></span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.Collections;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> ArrayList&lt;Integer&gt; <span class="title">printListFromTailToHead</span><span class="params">(ListNode listNode)</span> </span>&#123;</span><br><span class="line">        ArrayList&lt;Integer&gt; res = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">        <span class="keyword">while</span>(listNode != <span class="keyword">null</span>)&#123;</span><br><span class="line">            res.add(listNode.val);</span><br><span class="line">            listNode = listNode.next;</span><br><span class="line">        &#125;</span><br><span class="line">        Collections.reverse(res);</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="4"><a href="#4" class="headerlink" title="4"></a>4</h5><p>时间限制：1秒 空间限制：32768K<br>题目描述<br>输入某二叉树的前序遍历和中序遍历的结果，请重建出该二叉树。假设输入的前序遍历和中序遍历的结果中都不含重复的数字。例如输入前序遍历序列{1,2,4,7,3,5,6,8}和中序遍历序列{4,7,2,1,5,3,8,6}，则重建二叉树并返回。</p>
<p>答案：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">算法思想：</span></span><br><span class="line"><span class="comment">1. 先序遍历第一个位置肯定是根节点node</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">2. 中序遍历的根节点位置在中间p，在p左边的肯定是node的左子树的中序数组，p右边的肯定是node的右子树的中序数组  </span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">3. 先序遍历的第二个位置到p，也是node左子树的先序子数组，剩下p右边的就是node的右子树的先序子数组</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">4. 把四个数组找出来，分左右递归调用即可</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Definition for binary tree</span></span><br><span class="line"><span class="comment"> * public class TreeNode &#123;</span></span><br><span class="line"><span class="comment"> *     int val;</span></span><br><span class="line"><span class="comment"> *     TreeNode left;</span></span><br><span class="line"><span class="comment"> *     TreeNode right;</span></span><br><span class="line"><span class="comment"> *     TreeNode(int x) &#123; val = x; &#125;</span></span><br><span class="line"><span class="comment"> * &#125;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="comment">// 解法1：</span></span><br><span class="line"><span class="comment">// 每次直接拷贝出对应的四个数组，然后递归调用</span></span><br><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> TreeNode <span class="title">reConstructBinaryTree</span><span class="params">(<span class="keyword">int</span> [] pre,<span class="keyword">int</span> [] in)</span> </span>&#123;</span><br><span class="line">         <span class="keyword">if</span>(pre.length == <span class="number">0</span> || in.length == <span class="number">0</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        TreeNode node = <span class="keyword">new</span> TreeNode(pre[<span class="number">0</span>]);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; in.length; i++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (pre[<span class="number">0</span>] == in[i]) &#123;</span><br><span class="line">                node.left = reConstructBinaryTree(Arrays.copyOfRange(pre, <span class="number">1</span>, i+<span class="number">1</span>), Arrays.copyOfRange(in, <span class="number">0</span>, i));</span><br><span class="line">                node.right = reConstructBinaryTree(Arrays.copyOfRange(pre, i+<span class="number">1</span>, pre.length), Arrays.copyOfRange(in, i+<span class="number">1</span>, in.length));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> node;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 解法2：</span></span><br><span class="line"><span class="comment">// 传递原数组、以及数组中对应的开始位置和长度，然后递归调用</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> TreeNode <span class="title">reConstructBinaryTree</span><span class="params">(<span class="keyword">int</span> [] pre,<span class="keyword">int</span> [] in)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> reConstructBinaryTree(pre, in, <span class="number">0</span>, <span class="number">0</span>, pre.length);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 每次都传递原数组的引用，不需要进行数组拷贝，但是要注意：</span></span><br><span class="line"><span class="comment">     *   先序和中序开始的位置是不一样的</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> pre 原先序数组</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> in 原中序数组</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> preBeginIndex 先序数组中开始的索引</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> inBeginIndex 中序数组中开始的索引</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> length 本次要重建的长度</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> TreeNode <span class="title">reConstructBinaryTree</span><span class="params">(<span class="keyword">int</span>[] pre, <span class="keyword">int</span>[] in,</span></span></span><br><span class="line"><span class="params"><span class="function">                                          <span class="keyword">int</span> preBeginIndex, <span class="keyword">int</span> inBeginIndex, <span class="keyword">int</span> length)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 判断是否越界，以及本次长度是否为0</span></span><br><span class="line">        <span class="keyword">if</span> (preBeginIndex &lt; <span class="number">0</span> || preBeginIndex + length &gt; pre.length</span><br><span class="line">                || inBeginIndex &lt; <span class="number">0</span> || inBeginIndex + length &gt; pre.length || length &lt;= <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 先序遍历第一个位置肯定是根节点node</span></span><br><span class="line">        TreeNode root = <span class="keyword">new</span> TreeNode(pre[preBeginIndex]);</span><br><span class="line">        <span class="keyword">int</span> rootIndex = preBeginIndex;</span><br><span class="line">        <span class="comment">// 左子树的长度</span></span><br><span class="line">        <span class="keyword">int</span> leftLength = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = inBeginIndex; i &lt; inBeginIndex + length; i ++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (pre[preBeginIndex] == in[i]) &#123;</span><br><span class="line">                rootIndex = i;</span><br><span class="line">                leftLength = i - inBeginIndex;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 右子树的长度</span></span><br><span class="line">        <span class="keyword">int</span> rightLength = length - leftLength - <span class="number">1</span>;</span><br><span class="line">        root.left = reConstructBinaryTree(pre, in, preBeginIndex + <span class="number">1</span>, inBeginIndex, leftLength);</span><br><span class="line">        root.right = reConstructBinaryTree(pre, in, preBeginIndex + leftLength + <span class="number">1</span>, rootIndex + <span class="number">1</span>, rightLength);</span><br><span class="line">        <span class="keyword">return</span> root;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h4 id="链接"><a href="#链接" class="headerlink" title="链接"></a>链接</h4><p>1、<a target="_blank" rel="noopener" href="https://www.nowcoder.com/ta/coding-interviews">https://www.nowcoder.com/ta/coding-interviews</a><br>2、<a target="_blank" rel="noopener" href="https://leetcode.com/problemset/top-100-liked-questions/">https://leetcode.com/problemset/top-100-liked-questions/</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://www.apomelo.cc/posts/java/2019-04-18/jvm%E4%B8%ADgc%E4%B8%93%E9%A2%98/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Apomelo">
      <meta itemprop="description" content="我有一壶酒，足以慰风尘。尽倾江海里，赠饮天下人。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Apomelo - 追逐">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/posts/java/2019-04-18/jvm%E4%B8%ADgc%E4%B8%93%E9%A2%98/" class="post-title-link" itemprop="url">JVM中GC专题（GC算法、回收器、内存泄露排查等等）</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019-04-18 00:00:00" itemprop="dateCreated datePublished" datetime="2019-04-18T00:00:00+08:00">2019-04-18</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/java/" itemprop="url" rel="index"><span itemprop="name">java</span></a>
                </span>
            </span>

          
            <span id="/posts/java/2019-04-18/jvm%E4%B8%ADgc%E4%B8%93%E9%A2%98/" class="post-meta-item leancloud_visitors" data-flag-title="JVM中GC专题（GC算法、回收器、内存泄露排查等等）" title="阅读次数">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span class="leancloud-visitors-count"></span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h4 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h4><p>这一年多时间里，不断的看过一些关于GC的知识，有的来自于网上，有的来自于书里。这之间也碰到过内存泄漏、内存调优的问题，今天整理一下这段时间记录的笔记。之后如果有扩展，也会同步更新到本文，不会新开一文。</p>
<h4 id="Java虚拟机简介"><a href="#Java虚拟机简介" class="headerlink" title="Java虚拟机简介"></a>Java虚拟机简介</h4><p>Java 虚拟机是整个 Java 平台的基石，是 Java 技术用以实现硬件无关与操作系统无关的关键部分，是 Java 语言生成出极小体积的编译代码的运行平台，是保障用户机器免于恶意代码损害的保护屏障。</p>
<h5 id="历史和特性"><a href="#历史和特性" class="headerlink" title="历史和特性"></a>历史和特性</h5><p>第一个 Java 虚拟机的原型机是由 Sun Microsystems 公司实现的，它被用在一种类似 PDA（Personal Digital Assistant，俗称掌上电脑）的手持设备上仿真实现 Java 虚拟机指令集。时至今日， Oracle 已有许多 Java 虚拟机实现应用于移动设备、桌面电脑、服务器等领域。</p>
<p>Java 虚拟机并不局限于特定的<strong>实现技术、主机硬件和操作系统</strong>， Java 虚拟机也不局限于特定的<strong>代码执行方式</strong>，它不强求使用解释器来执行程序，也可以通过把自己的指令集编译为实际 CPU 的指令来实现，它可以通过微代码（Microcode）来实现，或者甚至直接实现在 CPU 中。</p>
<h5 id="Class文件格式"><a href="#Class文件格式" class="headerlink" title="Class文件格式"></a>Class文件格式</h5><p>精确地定义了类与接口的表现形式，包括与<strong>平台相关的目标文件格式中</strong>一些细节的惯例。</p>
<p>包含了Java虚拟机指令集和符号表，以及其他一些辅助信息。</p>
<h4 id="GC简介"><a href="#GC简介" class="headerlink" title="GC简介"></a>GC简介</h4><p>垃圾回收(Garbage Collection)是Java虚拟机(JVM)垃圾回收器提供的一种用于在<label style="color:red; font-family:微软雅黑">空闲时间、不定时回收、无任何对象引用</label>的对象所占据的内存空间的一种机制。</p>
<h4 id="判断对象是否存活的算法"><a href="#判断对象是否存活的算法" class="headerlink" title="判断对象是否存活的算法"></a>判断对象是否存活的算法</h4><ol>
<li>引用计数算法（Reference Counting）</li>
</ol>
<p>给对象中添加一个引用计数器。当一个对象被创建并初始化赋值后，该变量计数设置为1。<br>每当有一个地方引用它时，计数器值就加1（a = b， b被引用，则b引用的对象计数+1）。<br>当引用失效时（一个对象的某个引用超过了生命周期（出作用域后）或者被设置为一个新值时），计数器值就减1。任何引用计数为0的对象就是不可能再被使用的。<br><strong>缺点</strong>：对象循环引用时不可被回收。例：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">A</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> Object instance = <span class="keyword">null</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestA</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        A a1 = <span class="keyword">new</span> A();</span><br><span class="line">        A a2 = <span class="keyword">new</span> A();</span><br><span class="line">        a1.instance = a2;</span><br><span class="line">        a2.instance = a1;</span><br><span class="line">    </span><br><span class="line">        a1 = <span class="keyword">null</span>;</span><br><span class="line">        a2 = <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<ol start="2">
<li>可达性分析算法（Reachability Analysis）</li>
</ol>
<p>通过一系列名为”GC Roots”的对象作为起始点向下搜索，搜索走过的路径称为引用链，当一个对象到GC Roots没有任何引用链相连时，就证明此对象是不可用的。</p>
<p>在根搜索算法中，要真正宣告一个对象死亡，至少要经历两次标记过程：</p>
<blockquote>
<p>(1) 如果对象在进行根搜索后发现没有与GC Roots相连接的引用链，那它会被第一次标记并且进行一次筛选。筛选的条件是此对象是否有必要执行finalize()方法（可看作析构函数，类似于OC中的dealloc，Swift中的deinit）。当对象没有覆盖finalize()方法，或finalize()方法已经被虚拟机调用过，虚拟机将这两种情况都视为没有必要执行。<br> <br>(2) 如果该对象被判定为有必要执行finalize()方法，那么这个对象将会被放置在一个名为F-Queue队列中，并在稍后由一条由虚拟机自动建立的、低优先级的Finalizer线程去执行finalize()方法。finalize()方法是对象逃脱死亡命运的最后一次机会（因为一个对象的finalize()方法最多只会被系统自动调用一次），稍后GC将对F-Queue中的对象进行第二次小规模的标记，如果要在finalize()方法中成功拯救自己，只要在finalize()方法中让该对象重新引用链上的任何一个对象建立关联即可。而如果对象这时还没有关联到任何链上的引用，那它就会被回收掉。</p>
</blockquote>
<p><strong>GC Roots:</strong></p>
<ol>
<li>虚拟机栈中引用的对象</li>
<li>方法区中常量引用的对象</li>
<li>方法区中静态属性引用的变量</li>
<li>本地方法栈JNI（一般指naive方法）中引用的对象</li>
</ol>
<p>也可以理解为下面几种（引用于<a target="_blank" rel="noopener" href="http://help.eclipse.org/luna/index.jsp?topic=/org.eclipse.mat.ui.help/concepts/gcroots.html&cp=37_2_3">Help - Eclipse Platform</a>）：</p>
<ul>
<li>System Class - 由初始、系统类加载器(bootstrap/system class loader)加载的对象</li>
<li>JNI Local - native代码中的local变量</li>
<li>JNI Global - native代码中的global变量</li>
<li>Thread Block - 活动的线程块引用的对象</li>
<li>Thread - 活着的线程</li>
<li>Busy Monitor - 调用了wait()、notify()方法的对象，同步的对象</li>
<li>Java Local - local变量</li>
<li>Native Stack - native代码中in或out参数，例如：用户定义的JNI代码或JVM内部代码。通常是这种情况，因为许多方法具有native部分，并且作为方法参数处理的对象成为GC根。</li>
<li>Finalizable - 等待finalizer运行的队列中的对象</li>
<li>Unfinalized - 具有finalize方法但尚未终止且不在finalizer队列中的对象</li>
<li>Unreachable - 从任何其他根无法访问的对象，但为了保留改对象已被MAT标记为根，否则不会包含在分析中的对象</li>
<li>Java Stack Frame - java栈帧（持有本地变量）。仅在使用首选项集解析转储时生成，以将Java堆栈帧视为对象。</li>
<li>Unknown - 未知的根类型对象。某些转储（例如IBM Portable Heap Dump文件）没有根信息。对于这些转储，MAT解析器标记没有入站引用或无法从任何其他根作为此类型的根进行访问的对象。这可确保MAT保留转储中的所有对象。</li>
</ul>
<h4 id="引用类型"><a href="#引用类型" class="headerlink" title="引用类型"></a>引用类型</h4><ol>
<li>强引用（Strong Reference）<br>如“Object obj = new Object（）”，这类引用是Java程序中最普遍的。只要强引用还存在，垃圾收集器就永远不会回收掉被引用的对象。</li>
<li>软引用（Soft Reference）<br>它用来描述一些可能还有用，但并非必须的对象。在系统内存不够用时，这类引用关联的对象将被垃圾收集器回收。JDK1.2之后提供了SoftReference类来实现软引用。</li>
<li>弱引用（Weak Reference）<br>它也是用来描述非须对象的，但它的强度比软引用更弱些，被弱引用关联的对象只能生存到下一次垃圾收集发生之前。当垃圾收集器工作时，无论当前内存是否足够，都会回收掉只被弱引用关联的对象。在JDK1.2之后，提供了WeakReference类来实现弱引用。</li>
<li>虚引用（Phantom Reference）<br>最弱的一种引用关系，完全不会对其生存时间构成影响，也无法通过虚引用来取得一个对象实例。为一个对象设置虚引用关联的唯一目的是希望能在这个对象被收集器回收时收到一个系统通知。JDK1.2之后提供了PhantomReference类来实现虚引用。</li>
</ol>
<table>
<thead>
<tr>
<th align="center">引用类型</th>
<th align="center">GC回收时间</th>
<th align="center">用途</th>
<th align="center">生存时间</th>
</tr>
</thead>
<tbody><tr>
<td align="center">强引用</td>
<td align="center">Never</td>
<td align="center">-</td>
<td align="center">JVM停止运行时</td>
</tr>
<tr>
<td align="center">弱引用</td>
<td align="center">内存不足时</td>
<td align="center">对象缓存</td>
<td align="center">内存不足时</td>
</tr>
<tr>
<td align="center">软引用</td>
<td align="center">GC时</td>
<td align="center">对象缓存</td>
<td align="center">下一次GC</td>
</tr>
<tr>
<td align="center">虚引用</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">-</td>
</tr>
</tbody></table>
<h4 id="回收算法"><a href="#回收算法" class="headerlink" title="回收算法"></a>回收算法</h4><h5 id="标记—复制算法"><a href="#标记—复制算法" class="headerlink" title="标记—复制算法"></a>标记—复制算法</h5><p>定义：将可用内存划分成相等大小两块，每次只使用其中一块，当这一块用完后将还存活的对象复制到另一块，然后将已使用过的内存一次清理。<br>适用：存活对象较少的垃圾回收，一般用于新生代（新生代内存默认按照8:1:1分为Eden，From Survivor，To Survivor三个空间，每次浪费10%）。<br>缺点：内存缩小为原来的一半。<br>优点：每次对整个半区进行内存回收，不用考虑内存碎片问题，只要移动堆顶指针，按顺序分配内存即可；实现简单，运行高效。<br><img src="/imgs/jvm%E4%B8%ADgc%E4%B8%93%E9%A2%98/%E6%A0%87%E8%AE%B0%E5%A4%8D%E5%88%B6%E5%9B%9E%E6%94%B6%E5%89%8D%E5%90%8E%E7%8A%B6%E6%80%81.png" alt="标记复制回收前后状态"></p>
<h5 id="标记—整理算法"><a href="#标记—整理算法" class="headerlink" title="标记—整理算法"></a>标记—整理算法</h5><p>定义：先标记要回收的对象，将存活对象移至一端，最后清理端边界以外的内存<br>适用：一般用于年老代<br><img src="/imgs/jvm%E4%B8%ADgc%E4%B8%93%E9%A2%98/%E6%A0%87%E8%AE%B0%E6%95%B4%E7%90%86%E5%9B%9E%E6%94%B6%E5%89%8D%E5%90%8E%E7%8A%B6%E6%80%81.png" alt="标记整理回收前后状态"></p>
<h5 id="标记—清除算法"><a href="#标记—清除算法" class="headerlink" title="标记—清除算法"></a>标记—清除算法</h5><p>定义：先标记要回收的对象，然后统一回收<br>适用：存活对象较多的垃圾回收<br>缺点：会产生大量不连续的内存碎片，需要定期整理<br><img src="/imgs/jvm%E4%B8%ADgc%E4%B8%93%E9%A2%98/%E6%A0%87%E8%AE%B0%E6%B8%85%E9%99%A4%E5%9B%9E%E6%94%B6%E5%89%8D%E5%90%8E%E7%8A%B6%E6%80%81.png" alt="标记清除回收前后状态"></p>
<h4 id="垃圾收集器"><a href="#垃圾收集器" class="headerlink" title="垃圾收集器"></a>垃圾收集器</h4><p>常见的垃圾收集器有七种，以下是关系图，连线表示可以搭配使用：<br><img src="/imgs/jvm%E4%B8%ADgc%E4%B8%93%E9%A2%98/%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6%E5%99%A8%E5%88%86%E7%B1%BB%E5%9B%BE.png" alt="垃圾回收器分类图.png"></p>
<h5 id="Serial收集器"><a href="#Serial收集器" class="headerlink" title="Serial收集器"></a>Serial收集器</h5><p>算法：标记—复制<br>用于：新生代<br>特性：单线程，在进行垃圾收集时必须暂停其他所有的工作线程（”Stop the World”）。虚拟机运行在Client模式下的默认新生代收集器。</p>
<h5 id="ParNew收集器"><a href="#ParNew收集器" class="headerlink" title="ParNew收集器"></a>ParNew收集器</h5><p>算法：标记—复制<br>用于：新生代<br>特性：并发收集，Serial收集器的多线程版本。一般是Server模式下的虚拟机中首选的新生代收集器。</p>
<h5 id="Parallel-Scavenge收集器"><a href="#Parallel-Scavenge收集器" class="headerlink" title="Parallel Scavenge收集器"></a>Parallel Scavenge收集器</h5><p>算法：标记—复制<br>用于：新生代<br>特性：并发收集，关注点与其他收集器不同，CMS等收集器的关注点是尽可能缩短垃圾收集时用户线程的停顿时间，而Parallel Scavenge收集器的目的则是达到一个可控制的吞吐量（Throughput, 吞吐量=运行用户代码时间/(运行用户代码时间+垃圾收集时间)），虚拟机总共运行了100分钟，其中垃圾收集花掉1分钟，吞吐量就是99%。</p>
<h5 id="Serial-Old收集器"><a href="#Serial-Old收集器" class="headerlink" title="Serial Old收集器"></a>Serial Old收集器</h5><p>算法：标记—整理<br>用于：年老代<br>特性：单线程，Serial收集器的年老代版本。主要被Client模式下的虚拟机使用。</p>
<h5 id="Parallel-Old收集器"><a href="#Parallel-Old收集器" class="headerlink" title="Parallel Old收集器"></a>Parallel Old收集器</h5><p>算法：标记—整理<br>用于：年老代<br>特性：并发收集，Parallel Scavenge收集器的年老代版本，在注重吞吐量及CPU资源敏感的场合，都可以优先考虑Parallel Scavenge + Parallel Old收集器。</p>
<h5 id="CMS收集器（Concurrent-Mark-Sweep）"><a href="#CMS收集器（Concurrent-Mark-Sweep）" class="headerlink" title="CMS收集器（Concurrent Mark Sweep）"></a>CMS收集器（Concurrent Mark Sweep）</h5><p>算法：标记—清除<br>用于：年老代<br>特性：并发收集、低停顿。以获取最短回收停顿时间为目的。当需要服务的响应速度块、系统停顿时间短，可以优先考虑ParNew + CMS收集器。<br>过程：</p>
<ul>
<li>初始标记（CMS initial mark）：需要”Stop The World”，标记GC Roots能直接关联到的对象，速度快。</li>
<li>并发标记（CMS concurrent mark）：进行GC Roots Tracing过程。</li>
<li>重新标记（CMS remark）：需要”Stop The World”，修正并发标记期间，因用户程序继续运行而导致标记产生变动的那一部分对象的标记记录。停顿时间：初始标记&lt;重新标记&lt;&lt;并发标记。</li>
<li>并发清除（CMS concurrent sweep）：清除标记后要回收的对象，时间较长。</li>
</ul>
<h5 id="G1收集器（Garbage-First）"><a href="#G1收集器（Garbage-First）" class="headerlink" title="G1收集器（Garbage First）"></a>G1收集器（Garbage First）</h5><p>算法：基于“标记-整理”<br>用于：独自管理整个Java堆内存，不需要和其他收集器配合使用<br>特性：</p>
<ul>
<li>并发收集</li>
<li>可预测的停顿时间</li>
<li>压缩空间方面有优势</li>
<li>内部依然区分新生代和年老代，但是Eden, Survivor, Old区不再固定、在内存使用效率上来说更灵活。</li>
<li>将整个Java堆（包括新生代、年老代）划分为多个大小固定的独立区域（Region），并且跟踪这些区域里面的垃圾堆积程度，在后台维护一个优先列表，每次根据允许的收集时间，优先回收垃圾最多的区域（这就是Garbage First名称的由来）。区域划分、有优先级的区域回收。<br>过程：</li>
<li>初始标记（CMS initial mark）：需要”Stop The World”，标记GC Roots能直接关联到的对象，速度快。</li>
<li>并发标记（CMS concurrent mark）：进行GC Roots Tracing过程，此过程之间可以进行年轻代收集。</li>
<li>重新标记（CMS remark）：完全标记堆中的活跃对象，使用一个叫作snapshot-at-the-beginning(SATB)的比CMS收集器的更快的算法。此过程需要一个暂停的时间，去处理剩下的SATB日志缓冲区和所有更新，找出所有未被访问的存活对象，同时安全完成存活数据计算，这个阶段也是并发执行的。</li>
<li>选择回收（CMS concurrent sweep）：根据允许的收集时间，优先回收垃圾最多的区域。</li>
</ul>
<h4 id="内存泄露"><a href="#内存泄露" class="headerlink" title="内存泄露"></a>内存泄露</h4><p>一般来说，内存泄露的发生都是因为使用不当导致的。</p>
<p>使用不当又分为：</p>
<ol>
<li>自己写出来的死循环。</li>
<li>框架使用不当。例如：Disruptor中的RingBuffer、Netty中的ByteBuf</li>
<li>使用的开源库中存在内存泄露问题。</li>
</ol>
<p>解决方案：</p>
<ol>
<li>用jstack、jstat、jmap查看线程堆栈信息，并转写出堆转储文件。</li>
<li>放到win系统中用<a target="_blank" rel="noopener" href="https://www.ibm.com/developerworks/community/groups/service/html/communityview?communityUuid=4544bafe-c7a2-455f-9d43-eb866ea60091">IBM HeapAnalyzer</a>等类似工具进行分析。</li>
</ol>
<h4 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h4><p>1、因为笔记记录很久了，许多具体参考的哪些资料和文章已经找不到了，如果有参考您的文章请联系我,谢谢。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://www.apomelo.cc/posts/tool/2019-04-17/%E4%BF%AE%E6%94%B9%E6%96%87%E4%BB%B6%E4%B8%8E%E6%96%87%E4%BB%B6%E5%A4%B9%E6%97%B6%E9%97%B4/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Apomelo">
      <meta itemprop="description" content="我有一壶酒，足以慰风尘。尽倾江海里，赠饮天下人。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Apomelo - 追逐">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/posts/tool/2019-04-17/%E4%BF%AE%E6%94%B9%E6%96%87%E4%BB%B6%E4%B8%8E%E6%96%87%E4%BB%B6%E5%A4%B9%E6%97%B6%E9%97%B4/" class="post-title-link" itemprop="url">修改文件、文件夹——创建、修改、访问时间</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019-04-17 00:00:00" itemprop="dateCreated datePublished" datetime="2019-04-17T00:00:00+08:00">2019-04-17</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/tool/" itemprop="url" rel="index"><span itemprop="name">tool</span></a>
                </span>
            </span>

          
            <span id="/posts/tool/2019-04-17/%E4%BF%AE%E6%94%B9%E6%96%87%E4%BB%B6%E4%B8%8E%E6%96%87%E4%BB%B6%E5%A4%B9%E6%97%B6%E9%97%B4/" class="post-meta-item leancloud_visitors" data-flag-title="修改文件、文件夹——创建、修改、访问时间" title="阅读次数">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span class="leancloud-visitors-count"></span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h4 id="正文"><a href="#正文" class="headerlink" title="正文"></a>正文</h4><p>因为一些原因，需要进行修改文件或者文件夹的创建、修改、访问时间。</p>
<p>上网上搜索了一波，有的要修改系统当前时间，然后再对文件做一次修改；有的要下载某些工具（各种各样的工具）。实话说，很多乱七八糟的软件本人并不是很信任，所以就想自己做一个工具出来。</p>
<p>最初的时候我是考虑用Java进行编写，但为了方便快捷，后选择了Python编写，毕竟脚本语言，在这方面还是有优势的。总共写了两个版本：</p>
<ul>
<li>版本1<br>用了os、sys、time包，只能对文件、文件夹的修改时间、访问时间做修改</li>
<li>版本2<br>用了win32file、pywintypes、time中的组件，能对文件、文件夹的创建时间、修改时间、访问时间做修改，但是与系统耦合较大，与系统的类型、版本等等都有关系（不建议用这种方式）</li>
</ul>
<p>如果一定要修改创建时间，推荐用工具：<a target="_blank" rel="noopener" href="https://www.ghisler.com/">Total Commande</a></p>
<h4 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h4><p>版本1：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment">#_*_coding: utf-8 _*_</span></span><br><span class="line"><span class="comment">#@Time    : 2019/4/11 13:15</span></span><br><span class="line"><span class="comment">#@Author  : C</span></span><br><span class="line"><span class="comment">#@FileName: modifyFileTimeModule.py</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">modifyFileTime</span>(<span class="params">path, ctime_t, mtime_t, atime_t</span>):</span></span><br><span class="line">    <span class="keyword">if</span> os.path.isfile(path):</span><br><span class="line">        os.utime(path, (atime_t, mtime_t))</span><br><span class="line">    <span class="keyword">if</span> os.path.isdir(path):</span><br><span class="line">        file_list = os.listdir(path)</span><br><span class="line">        <span class="keyword">for</span> fName <span class="keyword">in</span> file_list:</span><br><span class="line">            modifyFileTime(path + <span class="string">&quot;/&quot;</span> + fName, ctime_t, mtime_t, atime_t)</span><br><span class="line">            </span><br><span class="line"><span class="comment"># 字符串前面 +r 表示不对字符串进行转义, 如: \\表示双斜杠,而非转义后的单斜杠</span></span><br><span class="line">path = <span class="string">r&#x27;C:/Users/viruser.v-desktop/Desktop/test/test.py&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># get arguments  </span></span><br><span class="line"><span class="comment"># cTime = fName[4:-7]</span></span><br><span class="line"><span class="comment"># mTime = cTime</span></span><br><span class="line"><span class="comment"># aTime = cTime</span></span><br><span class="line">cTime = <span class="string">&quot;2015-02-02 00:01:02&quot;</span> <span class="comment"># 创建时间</span></span><br><span class="line">mTime = <span class="string">&quot;2015-02-02 00:01:03&quot;</span> <span class="comment"># 修改时间</span></span><br><span class="line">aTime = <span class="string">&quot;2015-02-02 00:01:04&quot;</span> <span class="comment"># 访问时间</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># specify time format</span></span><br><span class="line"><span class="comment"># format = &quot;%Y%m%d_%H%M%S&quot;</span></span><br><span class="line"><span class="built_in">format</span> = <span class="string">&quot;%Y-%m-%d %H:%M:%S&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># create struct_time object</span></span><br><span class="line">ctime_t = time.mktime(time.strptime(cTime, <span class="built_in">format</span>))</span><br><span class="line">mtime_t = time.mktime(time.strptime(mTime, <span class="built_in">format</span>))</span><br><span class="line">atime_t = time.mktime(time.strptime(aTime, <span class="built_in">format</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment">#调用</span></span><br><span class="line">modifyFileTime(path, ctime_t, mtime_t, atime_t)</span><br></pre></td></tr></table></figure>

<p>版本2：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment">#_*_coding: utf-8 _*_</span></span><br><span class="line"><span class="comment">#@Time    : 2019/4/11 13:15</span></span><br><span class="line"><span class="comment">#@Author  : C</span></span><br><span class="line"><span class="comment">#@FileName: modifyFileTimeModule.py</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">from</span> win32file <span class="keyword">import</span> CreateFile, SetFileTime, GetFileTime, CloseHandle</span><br><span class="line"><span class="keyword">from</span> win32file <span class="keyword">import</span> GENERIC_READ, GENERIC_WRITE, OPEN_EXISTING</span><br><span class="line"><span class="keyword">from</span> pywintypes <span class="keyword">import</span> Time</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">modifyFileTime</span>(<span class="params">filePath,createTime,modifyTime,accessTime,offset</span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    用来修改任意文件的相关时间属性，时间格式：YYYY-MM-DD HH:MM:SS 例如：2019-02-02 00:01:02</span></span><br><span class="line"><span class="string">    :param filePath: 文件路径名</span></span><br><span class="line"><span class="string">    :param createTime: 创建时间</span></span><br><span class="line"><span class="string">    :param modifyTime: 修改时间</span></span><br><span class="line"><span class="string">    :param accessTime: 访问时间</span></span><br><span class="line"><span class="string">    :param offset: 时间偏移的秒数,tuple格式，顺序和参数时间对应</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="built_in">format</span> = <span class="string">&quot;%Y-%m-%d %H:%M:%S&quot;</span> <span class="comment">#时间格式</span></span><br><span class="line">        cTime_t = timeOffsetAndStruct(createTime, <span class="built_in">format</span>, offset[<span class="number">0</span>])</span><br><span class="line">        mTime_t = timeOffsetAndStruct(modifyTime, <span class="built_in">format</span>, offset[<span class="number">1</span>])</span><br><span class="line">        aTime_t = timeOffsetAndStruct(accessTime, <span class="built_in">format</span>, offset[<span class="number">2</span>])</span><br><span class="line"> </span><br><span class="line">        fh = CreateFile(filePath, GENERIC_READ | GENERIC_WRITE, <span class="number">0</span>, <span class="literal">None</span>, OPEN_EXISTING, <span class="number">0</span>, <span class="number">0</span>)</span><br><span class="line">        createTimes, accessTimes, modifyTimes = GetFileTime(fh)</span><br><span class="line"> </span><br><span class="line">        createTimes = Time(time.mktime(cTime_t))</span><br><span class="line">        accessTimes = Time(time.mktime(aTime_t))</span><br><span class="line">        modifyTimes = Time(time.mktime(mTime_t))</span><br><span class="line">        SetFileTime(fh, createTimes, accessTimes, modifyTimes)</span><br><span class="line">        CloseHandle(fh)</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">    <span class="keyword">except</span> BaseException <span class="keyword">as</span> e:</span><br><span class="line">        <span class="built_in">print</span>(e)</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">timeOffsetAndStruct</span>(<span class="params">times, <span class="built_in">format</span>, offset</span>):</span></span><br><span class="line">    <span class="keyword">return</span> time.localtime(time.mktime(time.strptime(times, <span class="built_in">format</span>)) + offset)</span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">cTime = <span class="string">&quot;2016-02-02 00:01:02&quot;</span> <span class="comment"># 创建时间</span></span><br><span class="line">mTime = <span class="string">&quot;2016-02-02 00:01:03&quot;</span> <span class="comment"># 修改时间</span></span><br><span class="line">aTime = <span class="string">&quot;2016-02-02 00:01:04&quot;</span> <span class="comment"># 访问时间</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 文件路径，字符串前面 +r 表示不对字符串进行转义, 如: \\表示双斜杠,而非转义后的单斜杠</span></span><br><span class="line">fName = <span class="string">r&quot;C:\Users\viruser.v-desktop\Desktop\python\你好答案 - 副本.png&quot;</span></span><br><span class="line"><span class="comment"># 偏移的秒数</span></span><br><span class="line">offset = (<span class="number">0</span>,<span class="number">1</span>,<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 调用</span></span><br><span class="line">r=modifyFileTime(fName,cTime,mTime,aTime,offset)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> r==<span class="number">0</span>:<span class="built_in">print</span>(<span class="string">&#x27;修改完成&#x27;</span>)</span><br><span class="line"><span class="keyword">if</span> r==<span class="number">1</span>:<span class="built_in">print</span>(<span class="string">&#x27;修改失败&#x27;</span>)</span><br></pre></td></tr></table></figure>

<h4 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h4><p>1、<a target="_blank" rel="noopener" href="https://blog.csdn.net/dengnihuilaiwpl/article/details/86551720">https://blog.csdn.net/dengnihuilaiwpl/article/details/86551720</a><br>2、<a target="_blank" rel="noopener" href="https://www.zhihu.com/question/38430949">https://www.zhihu.com/question/38430949</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://www.apomelo.cc/posts/protocol/2018-05-12/iax2%E5%8D%8F%E8%AE%AE%E6%96%87%E6%A1%A3%EF%BC%88rfc-5456%EF%BC%89%E4%B8%AD%E6%96%87%E7%BF%BB%E8%AF%91/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Apomelo">
      <meta itemprop="description" content="我有一壶酒，足以慰风尘。尽倾江海里，赠饮天下人。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Apomelo - 追逐">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/posts/protocol/2018-05-12/iax2%E5%8D%8F%E8%AE%AE%E6%96%87%E6%A1%A3%EF%BC%88rfc-5456%EF%BC%89%E4%B8%AD%E6%96%87%E7%BF%BB%E8%AF%91/" class="post-title-link" itemprop="url">IAX2协议文档（RFC 5456）中文翻译</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2018-05-12 00:00:00" itemprop="dateCreated datePublished" datetime="2018-05-12T00:00:00+08:00">2018-05-12</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2019-03-26 00:00:00" itemprop="dateModified" datetime="2019-03-26T00:00:00+08:00">2019-03-26</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/protocol/" itemprop="url" rel="index"><span itemprop="name">protocol</span></a>
                </span>
            </span>

          
            <span id="/posts/protocol/2018-05-12/iax2%E5%8D%8F%E8%AE%AE%E6%96%87%E6%A1%A3%EF%BC%88rfc-5456%EF%BC%89%E4%B8%AD%E6%96%87%E7%BF%BB%E8%AF%91/" class="post-meta-item leancloud_visitors" data-flag-title="IAX2协议文档（RFC 5456）中文翻译" title="阅读次数">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span class="leancloud-visitors-count"></span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>欢迎来到我的博客，这是我第一篇自己写的博客，也是第一次用markdown语法来写，怀着有些激动的心写下这篇博客。<br></p>
<p>在工作中接触到了IAX2协议，找遍了网上只找到了一些中文的论文。没有协议文档的具体翻译，最后只能自己看英文文档：<a target="_blank" rel="noopener" href="https://tools.ietf.org/html/rfc5456">《RFC 5456》</a>。后因需要整理IAX2文档，就开始整理一个简短的文档，但发现还有所不足，后就开始着手进行翻译，也是为之后需要中文文档的人提供一些帮助，完整的文档地址：<a target="_blank" rel="noopener" href="https://download.csdn.net/download/nosecure/10410387">IAX2协议文档（RFC 5456）中文翻译</a>。建议英文水平好的看原英文文档。<br></p>
<p>下面为大家简单介绍一下IAX2协议：<br></p>
<p>IAX 是 Inter-Asterisk eXchange 的缩写，也就是 Asterisk 内部交换协议。IAX最初用在Asterisk上。</p>
<p>IAX优点：</p>
<ol>
<li>只用一个UDP端口：4569，来传输通信数据，包括控制信令和媒体数据等。</li>
<li>媒体数据并不需要额外的RTP流，所以可以轻易穿越NAT。</li>
<li>媒体数据会用一个迷你帧来发送，迷你帧帧头只有4字节，不携带控制或信令数据，有效载荷比较大。迷你帧是不可靠传输，但由于语音通话通常是实时发送的，因此丢失的帧太旧而无法重新集成到音频流中，以至于无法重新传输，所以几乎没有影响，而且每65.536秒需要重置时间标志。</li>
<li>用二进制编码。</li>
</ol>
<p>IAX缺点:</p>
<ol>
<li>因为只用一个端口，所以容易被攻击。</li>
<li>编解码器定义由内部定义的32位掩码控制，因此编解码器必须在协议中定义，同时编解码器的最大数量受到限制。</li>
<li>实施问题（如果资源较少没有非常完善的库算的话）。</li>
<li>用二进制编码。</li>
</ol>
<p>协议里每个字段的具体含义及详细介绍请参见：</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://tools.ietf.org/html/rfc5456">英文文档《RFC 5456》</a></li>
<li><a target="_blank" rel="noopener" href="https://download.csdn.net/download/nosecure/10410387">IAX2协议文档（RFC 5456）中文翻译</a></li>
</ul>
<p>这里给大家推荐几个iax Java库：</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://code.google.com/archive/p/njiax/downloads">njiax</a><br>  实现的比较简陋，但是层次相对清晰，需要增加信令、完善交互流程等，线程创建数量较多，需要用线程池替代。</li>
<li><a target="_blank" rel="noopener" href="https://github.com/misternerd/djiax">djiax</a><br>  实现相对完善，也需要增加信令、完善交互流程编码等，线程复用，但是限制了电话的并发数，应该用线程池替代。</li>
<li><a target="_blank" rel="noopener" href="https://github.com/apomelo/njiax-a">njiax-a</a><br>  本人fork了njiax库，在此基础上增加部分信令、完善交互流程、增加G711和G729等编码方式、增加DTFMFrame处理、添加了简单的注册拨打示例等，详细信息见github。</li>
</ul>
<p align="right">可以转载，但请标明出处</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://www.apomelo.cc/posts/web/2018-11-26/%E5%89%8D%E7%AB%AF%E7%AC%94%E8%AE%B0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Apomelo">
      <meta itemprop="description" content="我有一壶酒，足以慰风尘。尽倾江海里，赠饮天下人。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Apomelo - 追逐">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/posts/web/2018-11-26/%E5%89%8D%E7%AB%AF%E7%AC%94%E8%AE%B0/" class="post-title-link" itemprop="url">前端笔记</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2018-11-26 00:00:00" itemprop="dateCreated datePublished" datetime="2018-11-26T00:00:00+08:00">2018-11-26</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2019-02-13 00:00:00" itemprop="dateModified" datetime="2019-02-13T00:00:00+08:00">2019-02-13</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/web/" itemprop="url" rel="index"><span itemprop="name">web</span></a>
                </span>
            </span>

          
            <span id="/posts/web/2018-11-26/%E5%89%8D%E7%AB%AF%E7%AC%94%E8%AE%B0/" class="post-meta-item leancloud_visitors" data-flag-title="前端笔记" title="阅读次数">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span class="leancloud-visitors-count"></span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h2><h3 id="前端访问后端地址，带有小数点导致参数不全"><a href="#前端访问后端地址，带有小数点导致参数不全" class="headerlink" title="前端访问后端地址，带有小数点导致参数不全"></a>前端访问后端地址，带有小数点导致参数不全</h3><p>例：</p>
<ol>
<li><a target="_blank" rel="noopener" href="https://localhost:3000/download/voice.wav">https://localhost:3000/download/voice.wav</a></li>
<li><a target="_blank" rel="noopener" href="https://localhost:3000/download/voice.wav?parameter=1">https://localhost:3000/download/voice.wav?parameter=1</a></li>
</ol>
<p>会忽略小数点之后的内容。<br>原因：url中含有小数点，浏览器会认为是访问的文件<br>解决办法：</p>
<ol>
<li>访问API时，url的末尾加  /， 如：<a target="_blank" rel="noopener" href="https://localhost:3000/download/voice.wav/">https://localhost:3000/download/voice.wav/</a></li>
<li>把带小数点的路径前移， 如：<a target="_blank" rel="noopener" href="https://localhost:3000/voice.wav/download">https://localhost:3000/voice.wav/download</a><br>在后端中，如果需要接收voice.wav这个参数，Spring可以用：<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(/&#123;fileName&#125;/download)</span></span><br><span class="line"><span class="keyword">public</span> ResponseEntity&lt;<span class="keyword">byte</span>[]&gt; download(<span class="meta">@RathVariable(&quot;fileName&quot;)</span> String fileName) &#123;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
<h2 id="JS"><a href="#JS" class="headerlink" title="JS"></a>JS</h2><h3 id="1-函数"><a href="#1-函数" class="headerlink" title="1.函数"></a>1.函数</h3><p>js中有三种：函数声明、函数表达式、匿名函数</p>
<p><strong>函数声明</strong>： <code>function fnName() &#123;...&#125;</code> ；<br>使用 function 关键字声明一个函数，再执行一个函数名，叫函数声明。</p>
<p><strong>函数表达式</strong>： <code>var fnName = function() &#123; ... &#125;</code> ；<br>使用 function 关键字声明一个函数，但未给函数命名，最后将匿名函数赋予一个变量，叫函数表达式，这是最常见的函数表达式语法形式。</p>
<p><strong>匿名函数</strong>： <code>function() &#123; ... &#125;</code> ；<br>使用 function 关键字声明一个函数，但未给函数命名，所以叫匿名函数，匿名函数属于函数表达式，匿名函数有很多作用，赋予一个变量则创建函数，赋予一个事件则成为事件处理程序或创建闭包等等。</p>
<p><strong>函数声明和函数表达式不同之处在于</strong><br/><br>1、JavaScript 引擎在解析 JavaScript 代码时会“函数声明提升”当前执行环境(作用域)上的函数声明，而函数表达式必须等到 JavaScript 引擎执行到它所在行时，才会从上而下一行一行地解析函数表达式。</p>
<p>2、函数表达式后面可以加括号立即调用该函数，函数声明不可以，只能以 fnName() 形式调用。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">(function(a) &#123;</span><br><span class="line">  console.log(a);  //使用()运算符，打印出123</span><br><span class="line">&#125;)(123);</span><br><span class="line"></span><br><span class="line">(function(a) &#123;</span><br><span class="line">  console.log(a);  //使用()运算符，打印出1234</span><br><span class="line">&#125;(1234));</span><br><span class="line"></span><br><span class="line">!function(a) &#123;</span><br><span class="line">  console.log(a);  //使用!运算符，打印出12345</span><br><span class="line">&#125;(12345);</span><br><span class="line"></span><br><span class="line">+function(a) &#123;</span><br><span class="line">  console.log(a);  //使用+运算符，打印出123456</span><br><span class="line">&#125;(123456);</span><br><span class="line"></span><br><span class="line">-function(a) &#123;</span><br><span class="line">  console.log(a);  //使用-运算符，打印出1234567</span><br><span class="line">&#125;(1234567);</span><br><span class="line"></span><br><span class="line">var fn = function(a) &#123;</span><br><span class="line">  console.log(a);  //使用=运算符，打印出12345678</span><br><span class="line">&#125;(12345678);</span><br></pre></td></tr></table></figure>

<p>可以看到输出结果，在 function 前面加 ! 、+ 、- 甚至是逗号等都可以起到函数定以后立即执行的效果，而 () 、! 、+ 、- 、= 等运算符，都将函数声明转换成函数表达式，消除了 javascript 引擎识别函数表达式和函数声明的歧义，告诉 javascript 引擎这是一个函数表达式，不是函数声明，可以在后面加括号，并立即执行函数的代码。</p>
<p>加括号是最安全的做法，因为 ! 、+ 、- 等运算符还会和函数的返回值进行运算，有时造成不必要的麻烦。</p>
<p><strong>立即执行函数作用</strong>：创建一个独立的作用域。<br>不过这样的写法有什么用呢？</p>
<p>javascript 中没有私有作用域的概念，如果在多人开发的项目上，你在全局或局部作用域中声明了一些变量，可能会被其他人不小心用同名的变量给覆盖掉，根据 javascript 函数作用域链的特性，可以使用这种技术可以模仿一个私有作用域，用匿名函数作为一个“容器”，“容器”内部可以访问外部的变量，而外部环境不能访问“容器”内部的变量，所以 (function(){ … })() 内部定义的变量不会和外部的变量发生冲突，俗称“匿名包裹器”或“命名空间”。</p>
<p>jQuery 使用的就是这种方法，将 jQuery 代码包裹在 (function(window,undefined){ …jquery代码…})(window) 中，在全局作用域中调用 jQuery 代码时，可以达到保护 jQuery 内部变量的作用。</p>
<p>参考资料：<a target="_blank" rel="noopener" href="http://www.css88.com/archives/7052">10道典型的JavaScript面试题</a></p>
<h3 id="splice-数组元素的插入删除与替换"><a href="#splice-数组元素的插入删除与替换" class="headerlink" title="splice()数组元素的插入删除与替换"></a>splice()数组元素的插入删除与替换</h3><p>面试的时候如果主考官让你使用JavaScript来实现对数组元素进行插入、删除、替换操作。如果不知道Array.prototype.splice的使用的方法那很有可能就要被扣分了。使用javascript数组类型内置的splice方法仅需一行代码即可轻松实现对数组元素进行插入、删除、替换操作。</p>
<p>方法名：Array.prototype.splice(index,count[,elm1,elm2…n])</p>
<p>使用Array类型的splice方法可以对数组元素进行插入、替换、删除。该方法讲直接影响当前的数组对象(与.slice(index1,index2)方法不同)并返回被删除的数组项。</p>
<p>参数：</p>
<p>index ：数组中元素的起始下标。<br>count ：需要要被删除或替换的元素个数。<br>elems ：需要插入到数组中的项。<br>返回值 ：返回从素组中被移除的项。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&lt;script type=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><br><span class="line"><span class="keyword">var</span> items =[<span class="string">&quot;a&quot;</span>,<span class="string">&quot;b&quot;</span>,<span class="string">&quot;c&quot;</span>,<span class="string">&quot;d&quot;</span>,<span class="string">&quot;e&quot;</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">//删除元素</span></span><br><span class="line">result = items.splice(<span class="number">1</span>,<span class="number">2</span>)</span><br><span class="line"><span class="comment">//这个操作删除了示例中items数组中的元素[&quot;b&quot;，&quot;c&quot;],并返回[&quot;b&quot;，&quot;c&quot;]给result.</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//替换元素</span></span><br><span class="line">result = items.splice(<span class="number">1</span>,<span class="number">2</span>,<span class="string">&quot;x&quot;</span>,<span class="string">&quot;y&quot;</span>)</span><br><span class="line"><span class="comment">//这个操作使用元素&quot;x&quot;,&quot;y&quot;替换了示例中items数组中的元素[&quot;b&quot;，&quot;c&quot;],并返回[&quot;b&quot;，&quot;c&quot;] 给 result.</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//插入元素</span></span><br><span class="line">result = items.splice(<span class="number">1</span>,<span class="number">0</span>,<span class="string">&quot;x&quot;</span>,<span class="string">&quot;y&quot;</span>)</span><br><span class="line"><span class="comment">//这个操作的结果是在示例中items数组的的&quot;b&quot;元素后插入[&quot;x&quot;,&quot;y&quot;],返回值为空。</span></span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Apomelo</p>
  <div class="site-description" itemprop="description">我有一壶酒，足以慰风尘。尽倾江海里，赠饮天下人。</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">13</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">7</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">27</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/apomelo" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;apomelo" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:apomeloc@gmail.com" title="E-Mail → mailto:apomeloc@gmail.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Apomelo</span>
</div>

        


  <div style="display: none;">
    <script src="https://s5.cnzz.com/z_stat.php?id=1277140459&web_id=1277140459"></script>
  </div>




<script>
  (function() {
    function leancloudSelector(url) {
      url = encodeURI(url);
      return document.getElementById(url).querySelector('.leancloud-visitors-count');
    }

    function addCount(Counter) {
      var visitors = document.querySelector('.leancloud_visitors');
      var url = decodeURI(visitors.id);
      var title = visitors.dataset.flagTitle;

      Counter('get', '/classes/Counter?where=' + encodeURIComponent(JSON.stringify({ url })))
        .then(response => response.json())
        .then(({ results }) => {
          if (results.length > 0) {
            var counter = results[0];
            leancloudSelector(url).innerText = counter.time + 1;
            Counter('put', '/classes/Counter/' + counter.objectId, { time: { '__op': 'Increment', 'amount': 1 } })
              .catch(error => {
                console.error('Failed to save visitor count', error);
              });
          } else {
              Counter('post', '/classes/Counter', { title, url, time: 1 })
                .then(response => response.json())
                .then(() => {
                  leancloudSelector(url).innerText = 1;
                })
                .catch(error => {
                  console.error('Failed to create', error);
                });
          }
        })
        .catch(error => {
          console.error('LeanCloud Counter Error', error);
        });
    }

    function showTime(Counter) {
      var visitors = document.querySelectorAll('.leancloud_visitors');
      var entries = [...visitors].map(element => {
        return decodeURI(element.id);
      });

      Counter('get', '/classes/Counter?where=' + encodeURIComponent(JSON.stringify({ url: { '$in': entries } })))
        .then(response => response.json())
        .then(({ results }) => {
          for (let url of entries) {
            let target = results.find(item => item.url === url);
            leancloudSelector(url).innerText = target ? target.time : 0;
          }
        })
        .catch(error => {
          console.error('LeanCloud Counter Error', error);
        });
    }

    let { app_id, app_key, server_url } = {"enable":true,"app_id":"N5VN0ybf5xGuqDFhjzC5RlRL-MdYXbMMI","app_key":"ru1RlOeEotFp87wLFIHucgVu","server_url":null,"security":false};
    function fetchData(api_server) {
      var Counter = (method, url, data) => {
        return fetch(`${api_server}/1.1${url}`, {
          method,
          headers: {
            'X-LC-Id'     : app_id,
            'X-LC-Key'    : app_key,
            'Content-Type': 'application/json',
          },
          body: JSON.stringify(data)
        });
      };
      if (CONFIG.page.isPost) {
        addCount(Counter);
      } else if (document.querySelectorAll('.post-title-link').length >= 1) {
        showTime(Counter);
      }
    }

    let api_server = app_id.slice(-9) !== '-MdYXbMMI' ? server_url : `https://${app_id.slice(0, 8).toLowerCase()}.api.lncldglobal.com`;

    if (api_server) {
      fetchData(api_server);
    } else {
      fetch('https://app-router.leancloud.cn/2/route?appId=' + app_id)
        .then(response => response.json())
        .then(({ api_server }) => {
          fetchData('https://' + api_server);
        });
    }
  })();
</script>


      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  
  <script>
    (function(){
      var canonicalURL, curProtocol;
      //Get the <link> tag
      var x=document.getElementsByTagName("link");
		//Find the last canonical URL
		if(x.length > 0){
			for (i=0;i<x.length;i++){
				if(x[i].rel.toLowerCase() == 'canonical' && x[i].href){
					canonicalURL=x[i].href;
				}
			}
		}
    //Get protocol
	    if (!canonicalURL){
	    	curProtocol = window.location.protocol.split(':')[0];
	    }
	    else{
	    	curProtocol = canonicalURL.split(':')[0];
	    }
      //Get current URL if the canonical URL does not exist
	    if (!canonicalURL) canonicalURL = window.location.href;
	    //Assign script content. Replace current URL with the canonical URL
      !function(){var e=/([http|https]:\/\/[a-zA-Z0-9\_\.]+\.baidu\.com)/gi,r=canonicalURL,t=document.referrer;if(!e.test(r)){var n=(String(curProtocol).toLowerCase() === 'https')?"https://sp0.baidu.com/9_Q4simg2RQJ8t7jm9iCKT-xh_/s.gif":"//api.share.baidu.com/s.gif";t?(n+="?r="+encodeURIComponent(document.referrer),r&&(n+="&l="+r)):r&&(n+="?l="+r);var i=new Image;i.src=n}}(window);})();
  </script>




  
<script src="//cdn.jsdelivr.net/npm/algoliasearch@4/dist/algoliasearch-lite.umd.js"></script>
<script src="//cdn.jsdelivr.net/npm/instantsearch.js@4/dist/instantsearch.production.min.js"></script>
<script src="/js/algolia-search.js"></script>














  

  

</body>
</html>
